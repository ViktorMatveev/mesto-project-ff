(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,o,r,c){var a=e.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__delete-button"),i=a.querySelector(".card__like-button"),s=a.querySelector(".card__like-counter"),l=a.querySelector(".card__image"),d=a.querySelector(".card__title");return l.src=t.link,l.alt=t.name,d.textContent=t.name,s.textContent=t.likes.length,n!==t.owner._id&&u.remove(),u.addEventListener("click",(function(){r(a,t)})),t.likes.some((function(e){return e._id===n}))?i.classList.add("card__like-button_is-active"):i.classList.remove("card__like-button_is-active"),i.addEventListener("click",(function(e){o(function(e){return!!e.classList.contains("card__like-button_is-active")}(e.target),t,a)})),a.addEventListener("click",c),a}function n(e,t){t.querySelector(".card__like-counter").textContent=e.likes.length,t.querySelector(".card__like-button").classList.toggle("card__like-button_is-active")}function o(e){e.classList.add("popup_is-opened"),e.addEventListener("click",r),window.addEventListener("keydown",a)}function r(e){e.target===document.querySelector(".popup_is-opened")&&c(document.querySelector(".popup_is-opened"))}function c(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",r),window.removeEventListener("keydown",a)}function a(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}var u={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function i(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(u.inputErrorClass),o.textContent=n,o.classList.add(u.errorClass)}function s(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(u.inputErrorClass),n.classList.remove(u.errorClass),n.textContent=""}function l(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(u.inactiveButtonClass)):(t.disabled=!0,t.classList.add(u.inactiveButtonClass))}function d(e){var t=Array.from(e.querySelectorAll(u.inputSelector));t.forEach((function(t){s(e,t)})),l(t,e.querySelector(u.submitButtonSelector))}function p(e,t,n,o){fetch(n.value).then((function(r){r.ok&&r.headers.get("Content-Type").includes("image")?e():(i(t,n,"URL не передает изображение"),o.disabled=!0,o.classList.add(u.inactiveButtonClass),o.textContent="Сохранить")})).catch((function(e){console.log("Oшибка запроса",e)}))}var f,_={baseUrl:"https://nomoreparties.co/v1/wff-cohort-9",headers:{authorization:"6822d671-11c6-4eec-8c5d-59a6a77e5591","Content-Type":"application/json"}},m=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},v=function(e){return fetch("".concat(_.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:_.headers}).then((function(e){return m(e)}))},h=function(e){return fetch("".concat(_.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:_.headers}).then((function(e){return m(e)}))},y=document.querySelector(".places__list"),S={},b=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),C=Array.from(document.querySelectorAll(".popup__close")),L=Array.from(document.querySelectorAll(".popup")),g=document.querySelector(".popup_type_avatar"),E=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card"),x=document.querySelector(".popup_type_image"),A=document.querySelector(".popup_type_delete-card"),U=x.querySelector(".popup__caption"),w=x.querySelector(".popup__image"),T=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),P=document.querySelector(".profile__image");function O(e,t,o){e?h(t._id).then((function(e){return n(e,o)})).catch((function(e){console.log(e)})):v(t._id).then((function(e){return n(e,o)})).catch((function(e){console.log(e)}))}function N(e){e.target.classList.contains("card__image")&&(o(x),w.src=e.target.src,w.alt=e.target.alt,U.textContent=e.target.alt)}L.forEach((function(e){return e.classList.add("popup_is-animated")})),P.addEventListener("click",(function(){j.reset(),d(g.querySelector(".popup__form")),o(g)})),b.addEventListener("click",(function(){V.value=T.textContent,z.value=B.textContent,d(E.querySelector(".popup__form")),o(E)})),q.addEventListener("click",(function(){F.reset(),d(k.querySelector(".popup__form")),o(k)})),C.forEach((function(e){return e.addEventListener("click",(function(){c(e.closest(".popup"))}))}));var j=document.forms["edit-avatar"],D=j.avatar,J=j.querySelector(".popup__button");function M(e){var t;(t=D.value,fetch("".concat(_.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:_.headers,body:JSON.stringify({avatar:t})}).then((function(e){return m(e)}))).then((function(e){P.style="background-image: url(".concat(e.avatar,")"),c(g)})).catch((function(e){console.log(e)})),J.textContent="Сохранить"}j.addEventListener("submit",(function(){J.textContent="Сохранение...",p(M,j,D,J)}));var H=document.forms["edit-profile"],V=H.name,z=H.description,R=H.querySelector(".popup__button");H.addEventListener("submit",(function(){var e,t;R.textContent="Сохранение...",(e=V.value,t=z.value,fetch("".concat(_.baseUrl,"/users/me"),{method:"PATCH",headers:_.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return m(e)}))).then((function(e){T.textContent=e.name,B.textContent=e.about,c(E)})).catch((function(e){console.log(e)})),R.textContent="Сохранить"}));var F=document.forms["new-place"],G=F["place-name"],I=F.link,K=F.querySelector(".popup__button");function Q(e){var n,o;(n=G.value,o=I.value,fetch("".concat(_.baseUrl,"/cards"),{method:"POST",headers:_.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return m(e)}))).then((function(e){var n=t(e,f,O,W,N);y.prepend(n),c(k)})).catch((function(e){console.log(e)})),K.textContent="Сохранить"}function W(e,t){o(A),S.card=e,S.id=t._id}F.addEventListener("submit",(function(){K.textContent="Сохранение...",p(Q,F,I,K)})),document.forms["delete-card"].addEventListener("submit",(function(){var e;(e=S.id,fetch("".concat(_.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:_.headers}).then((function(e){return m(e)}))).then((function(e){S.card.remove(),c(A)})).catch((function(e){console.log(e)}))})),Array.from(document.querySelectorAll(u.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(u.inputSelector)),n=e.querySelector(u.submitButtonSelector);l(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?s(e,t):i(e,t,t.validationMessage)}(e,o),l(t,n)}))}))}(e)})),Promise.all([fetch("".concat(_.baseUrl,"/users/me"),{headers:_.headers}).then((function(e){return m(e)})),fetch("".concat(_.baseUrl,"/cards"),{headers:_.headers}).then((function(e){return m(e)}))]).then((function(e){var n=e[0],o=e[1];T.textContent=n.name,B.textContent=n.about,P.style="background-image: url(".concat(n.avatar,")"),f=n._id,function(e){e.forEach((function(e){var n=t(e,f,O,W,N);y.append(n)}))}(o)})).catch((function(e){console.log(e)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LHlCQUFIM0UsT0FBNEIwRSxFQUFLRCxPQUFNLEtBQ3REM0MsRUFBVzRDLEVBQUs1RyxJQU92QixTQUFtQnFJLEdBQ2pCQSxFQUFNcEYsU0FBUSxTQUFDckUsR0FDYixJQUFNSyxFQUFjTixFQUNsQkMsRUFDQW9GLEVBQ0FsRixFQUNBQyxFQUNBQyxHQUVGNkYsRUFBV3lELE9BQU9ySixFQUNwQixHQUNGLENBakJJc0osQ0FBVUYsRUFDWixJQUNDekUsT0FBTSxTQUFDQyxHQUNOQyxRQUFRQyxJQUFJRixFQUNkLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0Ly4vc3JjL3NjcmlwdHMvY29ubXBvbmVudHMvY2FyZC5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0Ly4vc3JjL3NjcmlwdHMvY29ubXBvbmVudHMvbW9kYWwuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC8uL3NyYy9zY3JpcHRzL2Nvbm1wb25lbnRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC8uL3NyYy9zY3JpcHRzL2Nvbm1wb25lbnRzL2FwaS5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0Ly4vc3JjL3NjcmlwdHMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NhcmQtdGVtcGxhdGUnKS5jb250ZW50O1xyXG5cclxuZnVuY3Rpb24gY3JhZXRlQ2FyZChcclxuICBjYXJkRGF0YSxcclxuICB1c2VySWQsXHJcbiAgaGFuZGxlTGlrZUNhcmQsXHJcbiAgaGFuZGxlRGVsZXRlQ2FyZCxcclxuICBvcGVuSW1nUG9wdXBcclxuKSB7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmNhcmQnKS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgY29uc3QgZGVsZXRlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2RlbGV0ZS1idXR0b24nKTtcclxuICBjb25zdCBsaWtlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJyk7XHJcbiAgY29uc3QgbGlrZUNvdW50ZXIgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudGVyJyk7XHJcbiAgY29uc3QgY2FyZEltYWdlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2ltYWdlJyk7XHJcbiAgY29uc3QgY2FyZFRpdGxlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX3RpdGxlJyk7XHJcblxyXG4gIGNhcmRJbWFnZS5zcmMgPSBjYXJkRGF0YS5saW5rO1xyXG4gIGNhcmRJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xyXG4gIGNhcmRUaXRsZS50ZXh0Q29udGVudCA9IGNhcmREYXRhLm5hbWU7XHJcbiAgbGlrZUNvdW50ZXIudGV4dENvbnRlbnQgPSBjYXJkRGF0YS5saWtlcy5sZW5ndGg7XHJcblxyXG4gIC8vINGD0LTQsNC70Y/QtdC8INC60L7RgNC30LjQvdC60YMg0YEg0YfRg9C20L7QuSDQutCw0YDRgtC+0YfQutC4XHJcblxyXG4gIGlmICh1c2VySWQgIT09IGNhcmREYXRhLm93bmVyLl9pZCkge1xyXG4gICAgZGVsZXRlQnV0dG9uLnJlbW92ZSgpO1xyXG4gIH1cclxuXHJcbiAgLy8g0YHQu9GD0YjQsNGC0LXQu9GMINC90LAg0LrQvdC+0L/QutGDINGD0LTQsNC70LXQvdC40Y9cclxuXHJcbiAgZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgY2FyZERhdGEpO1xyXG4gIH0pO1xyXG5cclxuICAvLyDQvtCx0YDQsNCx0L7RgtGH0LjQuiDQu9Cw0LnQutCwINC/0YDQuCDQt9Cw0LPRgNGD0LrQtSDRgdGC0YDQsNC90LjRhtGLXHJcblxyXG4gIGlmIChjYXJkRGF0YS5saWtlcy5zb21lKChsaWtlcikgPT4gbGlrZXIuX2lkID09PSB1c2VySWQpKSB7XHJcbiAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG4gIH1cclxuXHJcbiAgLy8g0YHQu9GD0YjQsNGC0LXQu9GMINC90LAg0LrQvdC+0L/QutGDINC70LDQudC60LBcclxuXHJcbiAgbGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldnQpID0+IHtcclxuICAgIGhhbmRsZUxpa2VDYXJkKHRvZ2dsZUlzTGlrZWQoZXZ0LnRhcmdldCksIGNhcmREYXRhLCBjYXJkRWxlbWVudCk7XHJcbiAgfSk7XHJcblxyXG4gIC8vINGB0LvRg9GI0LDRgtC10LvRjCDQvdCwINC60LDRgNGC0LjQvdC60YNcclxuXHJcbiAgY2FyZEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvcGVuSW1nUG9wdXApO1xyXG5cclxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZUlzTGlrZWQobGlrZUJ1dHRvbikge1xyXG4gIHJldHVybiBsaWtlQnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJylcclxuICAgID8gdHJ1ZVxyXG4gICAgOiBmYWxzZTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hhbmdlTGlrZSh1cGRhdGVkQ2FyZCwgY2FyZEVsZW1lbnQpIHtcclxuICBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudGVyJykudGV4dENvbnRlbnQgPVxyXG4gICAgdXBkYXRlZENhcmQubGlrZXMubGVuZ3RoO1xyXG4gIGNhcmRFbGVtZW50XHJcbiAgICAucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJylcclxuICAgIC5jbGFzc0xpc3QudG9nZ2xlKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZGVsZXRlQ2FyZChjYXJkKSB7XHJcbiAgY2FyZC5yZW1vdmUoKTtcclxufVxyXG5cclxuZXhwb3J0IHsgY2FyZFRlbXBsYXRlLCBjcmFldGVDYXJkLCB0b2dnbGVJc0xpa2VkLCBkZWxldGVDYXJkLCBjaGFuZ2VMaWtlIH07XHJcbiIsImZ1bmN0aW9uIG9wZW5Nb2RhbChwb3B1cCkge1xyXG4gIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX2lzLW9wZW5lZCcpO1xyXG4gIHBvcHVwLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2tIYW5kbGVyKTtcclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGtleUhhbmRsZXIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbGlja0hhbmRsZXIoZXZ0KSB7XHJcbiAgaWYgKGV2dC50YXJnZXQgPT09IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9pcy1vcGVuZWQnKSkge1xyXG4gICAgY2xvc2VNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfaXMtb3BlbmVkJykpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2xvc2VNb2RhbChwb3B1cCkge1xyXG4gIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3BvcHVwX2lzLW9wZW5lZCcpO1xyXG4gIHBvcHVwLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2tIYW5kbGVyKTtcclxuICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGtleUhhbmRsZXIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBrZXlIYW5kbGVyKGV2dCkge1xyXG4gIGlmIChldnQua2V5ID09PSAnRXNjYXBlJykge1xyXG4gICAgY2xvc2VNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfaXMtb3BlbmVkJykpO1xyXG4gIH1cclxufVxyXG5leHBvcnQgeyBvcGVuTW9kYWwsIGNsb3NlTW9kYWwgfTtcclxuIiwiY29uc3QgdmFsaWRhdGlvbkNvbmZpZyA9IHtcclxuICBmb3JtU2VsZWN0b3I6ICcucG9wdXBfX2Zvcm0nLFxyXG4gIGlucHV0U2VsZWN0b3I6ICcucG9wdXBfX2lucHV0JyxcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJy5wb3B1cF9fYnV0dG9uJyxcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiAncG9wdXBfX2J1dHRvbl9kaXNhYmxlZCcsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiAncG9wdXBfX2lucHV0X3R5cGVfZXJyb3InLFxyXG4gIGVycm9yQ2xhc3M6ICdwb3B1cF9fZXJyb3JfdmlzaWJsZScsXHJcbn07XHJcblxyXG5mdW5jdGlvbiBzaG93SW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpIHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XHJcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZCh2YWxpZGF0aW9uQ29uZmlnLmVycm9yQ2xhc3MpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50KSB7XHJcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xyXG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHZhbGlkYXRpb25Db25maWcuaW5wdXRFcnJvckNsYXNzKTtcclxuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uQ29uZmlnLmVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9ICcnO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc1ZhbGlkKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQpIHtcclxuICBpZiAoaW5wdXRFbGVtZW50LnZhbGlkaXR5LnBhdHRlcm5NaXNtYXRjaCkge1xyXG4gICAgaW5wdXRFbGVtZW50LnNldEN1c3RvbVZhbGlkaXR5KGlucHV0RWxlbWVudC5kYXRhc2V0LmVycm9yTWVzc2FnZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGlucHV0RWxlbWVudC5zZXRDdXN0b21WYWxpZGl0eSgnJyk7XHJcbiAgfVxyXG5cclxuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCkge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHZhbGlkYXRpb25Db25maWcuaW5wdXRTZWxlY3RvcilcclxuICApO1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgdmFsaWRhdGlvbkNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3RvclxyXG4gICk7XHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KTtcclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGlzVmFsaWQoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCk7XHJcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9ICgpID0+IHtcclxuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHZhbGlkYXRpb25Db25maWcuZm9ybVNlbGVjdG9yKVxyXG4gICk7XHJcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcclxuICAgIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50KTtcclxuICB9KTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpIHtcclxuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCkge1xyXG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xyXG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICB9IGVsc2Uge1xyXG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHZhbGlkYXRpb25Db25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjbGVhclZhbGlkYXRpb24oZm9ybSkge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkNvbmZpZy5pbnB1dFNlbGVjdG9yKVxyXG4gICk7XHJcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybSwgaW5wdXRFbGVtZW50KTtcclxuICB9KTtcclxuICBjb25zdCBmb3JtQnV0dG9uID0gZm9ybS5xdWVyeVNlbGVjdG9yKHZhbGlkYXRpb25Db25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgZm9ybUJ1dHRvbik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzSW1hZ2VMaW5rKGhhbmRsZUZ1bmN0aW9uLCBmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBidXR0b25FbGVtZW50KSB7XHJcbiAgZmV0Y2goaW5wdXRFbGVtZW50LnZhbHVlKVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rICYmIHJlcy5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJykuaW5jbHVkZXMoJ2ltYWdlJykpIHtcclxuICAgICAgICBoYW5kbGVGdW5jdGlvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9ICdVUkwg0L3QtSDQv9C10YDQtdC00LDQtdGCINC40LfQvtCx0YDQsNC20LXQvdC40LUnO1xyXG4gICAgICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHZhbGlkYXRpb25Db25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICAgICAgYnV0dG9uRWxlbWVudC50ZXh0Q29udGVudCA9ICfQodC+0YXRgNCw0L3QuNGC0YwnO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coJ0/RiNC40LHQutCwINC30LDQv9GA0L7RgdCwJywgZXJyKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgeyBlbmFibGVWYWxpZGF0aW9uLCBjbGVhclZhbGlkYXRpb24sIHZhbGlkYXRpb25Db25maWcsIGlzSW1hZ2VMaW5rIH07XHJcbiIsIi8vIC0t0YDQsNCx0L7RgtCwINGBIEFQSS0tXHJcblxyXG4vLyDQotC+0LrQtdC9OiA2ODIyZDY3MS0xMWM2LTRlZWMtOGM1ZC01OWE2YTc3ZTU1OTFcclxuLy8g0JjQtNC10L3RgtC40YTQuNC60LDRgtC+0YAg0LPRgNGD0L/Qv9GLOiB3ZmYtY29ob3J0LTlcclxuXHJcbmNvbnN0IGNvbmZpZyA9IHtcclxuICBiYXNlVXJsOiAnaHR0cHM6Ly9ub21vcmVwYXJ0aWVzLmNvL3YxL3dmZi1jb2hvcnQtOScsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogJzY4MjJkNjcxLTExYzYtNGVlYy04YzVkLTU5YTZhNzdlNTU5MScsXHJcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gIH0sXHJcbn07XHJcblxyXG5jb25zdCBjaGVja1Jlc3BvbnNlID0gKHJlcykgPT4ge1xyXG4gIGlmIChyZXMub2spIHtcclxuICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyDQtdGB0LvQuCDQvtGI0LjQsdC60LAsINC+0YLQutC70L7QvdGP0LXQvCDQv9GA0L7QvNC40YFcclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgfVxyXG59O1xyXG5cclxuLy8g0LfQsNC/0YDQvtGBINC90LAg0L/QvtC70YPRh9C10L3QuNC1INC60LDRgNGC0L7Rh9C10LpcclxuXHJcbmNvbnN0IGdldEluaXRpYWxDYXJkcyA9ICgpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59O1xyXG5cclxuLy8g0LfQsNC/0YDQvtGBINC90LAg0LjQvdGE0L4g0L4g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C1XHJcblxyXG5jb25zdCBnZXRVc2VySW5mbyA9ICgpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59O1xyXG5cclxuLy8g0LfQsNC/0YDQvtGBINC90LAg0LjQt9C80LXQvdC10L3QuNC1INC40L3RhNC+0YDQvNCw0YbQuNC4INC+INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvQtVxyXG5cclxuY29uc3QgdXBkYXRlVXNlckluZm8gPSAodXNlck5hbWUsIHVzZXJBYm91dCkgPT4ge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICBtZXRob2Q6ICdQQVRDSCcsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZTogdXNlck5hbWUsIGFib3V0OiB1c2VyQWJvdXQgfSksXHJcbiAgfSkudGhlbigocmVzKSA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59O1xyXG5cclxuLy8g0LfQsNC/0YDQvtGBINC90LAg0LjQt9C80LXQvdC10L3QuNC1INCw0LLQsNGC0LDRgNCwINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRj1xyXG5cclxuY29uc3QgdXBkYXRlVXNlckF2YXRhciA9ICh1c2VyQXZhdGFyKSA9PiB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICBtZXRob2Q6ICdQQVRDSCcsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXZhdGFyOiB1c2VyQXZhdGFyIH0pLFxyXG4gIH0pLnRoZW4oKHJlcykgPT4gY2hlY2tSZXNwb25zZShyZXMpKTtcclxufTtcclxuXHJcbi8vINC30LDQv9GA0L7RgSDQvdCwINC00L7QsdCw0LLQu9C10L3QuNC1INC60LDRgNGC0L7Rh9C60Lgg0L3QsCDRgdC10YDQstC10YBcclxuXHJcbmNvbnN0IGFkZE5ld0NhcmRSZXF1ZXN0ID0gKGNhcmROYW1lLCBjYXJkTGluaykgPT4ge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lOiBjYXJkTmFtZSwgbGluazogY2FyZExpbmsgfSksXHJcbiAgfSkudGhlbigocmVzKSA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59O1xyXG5cclxuLy8g0LfQsNC/0YDQvtGBINC90LAg0LTQvtCx0LDQu9C10L3QuNC1INC70LDQudC60LBcclxuXHJcbmNvbnN0IGFkZExpa2VSZXF1ZXN0ID0gKGNhcmRJZCkgPT4ge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgbWV0aG9kOiAnUFVUJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gIH0pLnRoZW4oKHJlcykgPT4gY2hlY2tSZXNwb25zZShyZXMpKTtcclxufTtcclxuXHJcbi8vINC30LDQv9GA0L7RgSDQvdCwINGB0L3Rj9GC0LjQtSDQu9Cw0LnQutCwXHJcblxyXG5jb25zdCByZW1vdmVMaWtlUmVxdWVzdCA9IChjYXJkSWQpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICB9KS50aGVuKChyZXMpID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn07XHJcblxyXG4vLyDQt9Cw0L/RgNC+0YEg0L3QsCDRg9C00LDQu9C10L3QuNC1INC60LDRgNGC0L7Rh9C60LhcclxuXHJcbmNvbnN0IHJlbW92ZUNhcmQgPSAoY2FyZElkKSA9PiB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59O1xyXG5cclxuZXhwb3J0IHtcclxuICBnZXRJbml0aWFsQ2FyZHMsXHJcbiAgZ2V0VXNlckluZm8sXHJcbiAgdXBkYXRlVXNlckluZm8sXHJcbiAgdXBkYXRlVXNlckF2YXRhcixcclxuICBhZGROZXdDYXJkUmVxdWVzdCxcclxuICBhZGRMaWtlUmVxdWVzdCxcclxuICByZW1vdmVMaWtlUmVxdWVzdCxcclxuICByZW1vdmVDYXJkLFxyXG59O1xyXG4iLCJpbXBvcnQgJy4uL3BhZ2VzL2luZGV4LmNzcyc7XHJcblxyXG5pbXBvcnQgeyBjcmFldGVDYXJkLCBkZWxldGVDYXJkLCBjaGFuZ2VMaWtlIH0gZnJvbSAnLi9jb25tcG9uZW50cy9jYXJkJztcclxuXHJcbmltcG9ydCB7IG9wZW5Nb2RhbCwgY2xvc2VNb2RhbCB9IGZyb20gJy4vY29ubXBvbmVudHMvbW9kYWwnO1xyXG5cclxuaW1wb3J0IHtcclxuICBlbmFibGVWYWxpZGF0aW9uLFxyXG4gIGNsZWFyVmFsaWRhdGlvbixcclxuICB2YWxpZGF0aW9uQ29uZmlnLFxyXG4gIGlzSW1hZ2VMaW5rLFxyXG59IGZyb20gJy4vY29ubXBvbmVudHMvdmFsaWRhdGlvbic7XHJcblxyXG5pbXBvcnQge1xyXG4gIGdldEluaXRpYWxDYXJkcyxcclxuICBnZXRVc2VySW5mbyxcclxuICB1cGRhdGVVc2VySW5mbyxcclxuICB1cGRhdGVVc2VyQXZhdGFyLFxyXG4gIGFkZE5ld0NhcmRSZXF1ZXN0LFxyXG4gIGFkZExpa2VSZXF1ZXN0LFxyXG4gIHJlbW92ZUxpa2VSZXF1ZXN0LFxyXG4gIHJlbW92ZUNhcmQsXHJcbn0gZnJvbSAnLi9jb25tcG9uZW50cy9hcGknO1xyXG5cclxubGV0IG15VXNlcklkO1xyXG5jb25zdCBwbGFjZXNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYWNlc19fbGlzdCcpO1xyXG5jb25zdCBjYXJkVG9EZWxldGUgPSB7fTtcclxuXHJcbi8vIC1idXR0b25zLVxyXG5cclxuY29uc3QgZWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWJ1dHRvbicpO1xyXG5jb25zdCBhZGRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYWRkLWJ1dHRvbicpO1xyXG5jb25zdCBjbG9zZUJ1dHRvbnMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cF9fY2xvc2UnKSk7XHJcblxyXG4vLyAtcG9wdXBzLVxyXG5cclxuY29uc3QgcG9wdXBzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucG9wdXAnKSk7XHJcbmNvbnN0IHBvcHVwQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfYXZhdGFyJyk7XHJcbmNvbnN0IHBvcHVwUHJvZmlsZUVkaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9lZGl0Jyk7XHJcbmNvbnN0IHBvcHVwTmV3Q2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX25ldy1jYXJkJyk7XHJcbmNvbnN0IHBvcHVwSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9pbWFnZScpO1xyXG5jb25zdCBwb3B1cERlbGV0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2RlbGV0ZS1jYXJkJyk7XHJcbmNvbnN0IGNhcmRUaXRsZSA9IHBvcHVwSW1hZ2UucXVlcnlTZWxlY3RvcignLnBvcHVwX19jYXB0aW9uJyk7XHJcbmNvbnN0IHNjYWxlZEltZyA9IHBvcHVwSW1hZ2UucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbWFnZScpO1xyXG5cclxuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fdGl0bGUnKTtcclxuY29uc3QgcHJvZmlsZUpvYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19kZXNjcmlwdGlvbicpO1xyXG5jb25zdCBhdmF0YXJJbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UnKTtcclxuXHJcbnBvcHVwcy5mb3JFYWNoKChwb3B1cCkgPT4gcG9wdXAuY2xhc3NMaXN0LmFkZCgncG9wdXBfaXMtYW5pbWF0ZWQnKSk7XHJcblxyXG4vLyDRgdC70YPRiNCw0YLQtdC70Ywg0L7QsdGA0LDQsdC+0YLRh9C40LrQsCDQu9Cw0LnQutCwXHJcblxyXG5mdW5jdGlvbiBoYW5kbGVMaWtlQ2FyZChzdGF0dXMsIGNhcmREYXRhLCBjYXJkKSB7XHJcbiAgaWYgKCFzdGF0dXMpIHtcclxuICAgIGFkZExpa2VSZXF1ZXN0KGNhcmREYXRhLl9pZClcclxuICAgICAgLnRoZW4oKHJlcykgPT4gY2hhbmdlTGlrZShyZXMsIGNhcmQpKVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7IC8vINCy0YvQstC+0LTQuNC8INC+0YjQuNCx0LrRgyDQsiDQutC+0L3RgdC+0LvRjFxyXG4gICAgICB9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmVtb3ZlTGlrZVJlcXVlc3QoY2FyZERhdGEuX2lkKVxyXG4gICAgICAudGhlbigocmVzKSA9PiBjaGFuZ2VMaWtlKHJlcywgY2FyZCkpXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTsgLy8g0LLRi9Cy0L7QtNC40Lwg0L7RiNC40LHQutGDINCyINC60L7QvdGB0L7Qu9GMXHJcbiAgICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLy8gLS3QstGL0LfQvtCyINC4INC30LDRgNGL0YLQuNC1INC80L7QtNCw0LvRjNC90YvRhSDQvtC60L7QvS0tXHJcbi8vINCw0LLQsNGC0LDRgFxyXG5hdmF0YXJJbWcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgZm9ybU5ld0F2YXRhci5yZXNldCgpLFxyXG4gICAgY2xlYXJWYWxpZGF0aW9uKHBvcHVwQXZhdGFyLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybScpKSxcclxuICAgIG9wZW5Nb2RhbChwb3B1cEF2YXRhcik7XHJcbn0pO1xyXG5cclxuLy8g0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjQtSDQv9GA0L7RhNC40LvRj1xyXG5cclxuZWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBuYW1lLnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XHJcbiAgam9iLnZhbHVlID0gcHJvZmlsZUpvYi50ZXh0Q29udGVudDtcclxuICBjbGVhclZhbGlkYXRpb24ocG9wdXBQcm9maWxlRWRpdC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2Zvcm0nKSksXHJcbiAgICBvcGVuTW9kYWwocG9wdXBQcm9maWxlRWRpdCk7XHJcbn0pO1xyXG5cclxuLy8g0L3QvtCy0L7QtSDQvNC10YHRgtC+XHJcblxyXG5hZGRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgZm9ybU5ld1BsYWNlLnJlc2V0KCksXHJcbiAgICBjbGVhclZhbGlkYXRpb24ocG9wdXBOZXdDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybScpKSxcclxuICAgIG9wZW5Nb2RhbChwb3B1cE5ld0NhcmQpO1xyXG59KTtcclxuXHJcbmNsb3NlQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+XHJcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY2xvc2VNb2RhbChidXR0b24uY2xvc2VzdCgnLnBvcHVwJykpO1xyXG4gIH0pXHJcbik7XHJcblxyXG4vLyDQv9C+0L/QsNC/INGBINC60LDRgNGC0LjQvdC60L7QuVxyXG5cclxuZnVuY3Rpb24gb3BlbkltZ1BvcHVwKGV2dCkge1xyXG4gIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2FyZF9faW1hZ2UnKSkge1xyXG4gICAgb3Blbk1vZGFsKHBvcHVwSW1hZ2UpO1xyXG4gICAgc2NhbGVkSW1nLnNyYyA9IGV2dC50YXJnZXQuc3JjO1xyXG4gICAgc2NhbGVkSW1nLmFsdCA9IGV2dC50YXJnZXQuYWx0O1xyXG4gICAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gZXZ0LnRhcmdldC5hbHQ7XHJcbiAgfVxyXG59XHJcblxyXG4vLyAtLdCg0LDQsdC+0YLQsCDRgSDRhNC+0YDQvNCw0LzQuC0tXHJcblxyXG4vLyDRgdC80LXQvdC40YLRjCDQsNCy0LDRgtCw0YBcclxuXHJcbmNvbnN0IGZvcm1OZXdBdmF0YXIgPSBkb2N1bWVudC5mb3Jtc1snZWRpdC1hdmF0YXInXTtcclxuY29uc3QgbGlua0F2YXRhciA9IGZvcm1OZXdBdmF0YXJbJ2F2YXRhciddO1xyXG5jb25zdCBzYXZlQXZhdGFyQnV0dG9uID0gZm9ybU5ld0F2YXRhci5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlRm9ybU5ld0F2YXRhclN1Ym1pdChldnQpIHtcclxuICB1cGRhdGVVc2VyQXZhdGFyKGxpbmtBdmF0YXIudmFsdWUpXHJcbiAgICAudGhlbigodXNlcikgPT4ge1xyXG4gICAgICBhdmF0YXJJbWcuc3R5bGUgPSBgYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7dXNlci5hdmF0YXJ9KWA7XHJcbiAgICAgIGNsb3NlTW9kYWwocG9wdXBBdmF0YXIpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7IC8vINCy0YvQstC+0LTQuNC8INC+0YjQuNCx0LrRgyDQsiDQutC+0L3RgdC+0LvRjFxyXG4gICAgfSk7XHJcbiAgc2F2ZUF2YXRhckJ1dHRvbi50ZXh0Q29udGVudCA9ICfQodC+0YXRgNCw0L3QuNGC0YwnO1xyXG59XHJcbmZvcm1OZXdBdmF0YXIuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKCkgPT4ge1xyXG4gIHNhdmVBdmF0YXJCdXR0b24udGV4dENvbnRlbnQgPSAn0KHQvtGF0YDQsNC90LXQvdC40LUuLi4nO1xyXG4gIGlzSW1hZ2VMaW5rKFxyXG4gICAgaGFuZGxlRm9ybU5ld0F2YXRhclN1Ym1pdCxcclxuICAgIGZvcm1OZXdBdmF0YXIsXHJcbiAgICBsaW5rQXZhdGFyLFxyXG4gICAgc2F2ZUF2YXRhckJ1dHRvblxyXG4gICk7XHJcbn0pO1xyXG5cclxuLy8g0YDQtdC00LDQutGC0LjRgNCy0L7QsNGC0Ywg0L/RgNC+0YTQuNC70YxcclxuXHJcbmNvbnN0IGZvcm1FZGl0ID0gZG9jdW1lbnQuZm9ybXNbJ2VkaXQtcHJvZmlsZSddO1xyXG5jb25zdCBuYW1lID0gZm9ybUVkaXQubmFtZTtcclxuY29uc3Qgam9iID0gZm9ybUVkaXQuZGVzY3JpcHRpb247XHJcbmNvbnN0IHNhdmVVc2VySW5mb0J1dHRvbiA9IGZvcm1FZGl0LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fYnV0dG9uJyk7XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVGb3JtRWRpdFN1Ym1pdChldnQpIHtcclxuICB1cGRhdGVVc2VySW5mbyhuYW1lLnZhbHVlLCBqb2IudmFsdWUpXHJcbiAgICAudGhlbigodXNlcikgPT4ge1xyXG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXIubmFtZTtcclxuICAgICAgcHJvZmlsZUpvYi50ZXh0Q29udGVudCA9IHVzZXIuYWJvdXQ7XHJcbiAgICAgIGNsb3NlTW9kYWwocG9wdXBQcm9maWxlRWRpdCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTsgLy8g0LLRi9Cy0L7QtNC40Lwg0L7RiNC40LHQutGDINCyINC60L7QvdGB0L7Qu9GMXHJcbiAgICB9KTtcclxuICBzYXZlVXNlckluZm9CdXR0b24udGV4dENvbnRlbnQgPSAn0KHQvtGF0YDQsNC90LjRgtGMJztcclxufVxyXG5mb3JtRWRpdC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoKSA9PiB7XHJcbiAgc2F2ZVVzZXJJbmZvQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC10L3QuNC1Li4uJztcclxuICBoYW5kbGVGb3JtRWRpdFN1Ym1pdCgpO1xyXG59KTtcclxuXHJcbi8vINC90L7QstC+0LUg0LzQtdGB0YLQvlxyXG5cclxuY29uc3QgZm9ybU5ld1BsYWNlID0gZG9jdW1lbnQuZm9ybXNbJ25ldy1wbGFjZSddO1xyXG5jb25zdCBuYW1lUGxhY2UgPSBmb3JtTmV3UGxhY2VbJ3BsYWNlLW5hbWUnXTtcclxuY29uc3QgbGlua1BsYWNlID0gZm9ybU5ld1BsYWNlWydsaW5rJ107XHJcbmNvbnN0IHNhdmVQbGFjZUJ1dHRvbiA9IGZvcm1OZXdQbGFjZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlRm9ybU5ld1BsYWNlU3VibWl0KGV2dCkge1xyXG4gIGFkZE5ld0NhcmRSZXF1ZXN0KG5hbWVQbGFjZS52YWx1ZSwgbGlua1BsYWNlLnZhbHVlKVxyXG4gICAgLnRoZW4oKGNhcmREYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld0NhcmQgPSBjcmFldGVDYXJkKFxyXG4gICAgICAgIGNhcmREYXRhLFxyXG4gICAgICAgIG15VXNlcklkLFxyXG4gICAgICAgIGhhbmRsZUxpa2VDYXJkLFxyXG4gICAgICAgIGhhbmRsZURlbGV0ZUNhcmQsXHJcbiAgICAgICAgb3BlbkltZ1BvcHVwXHJcbiAgICAgICk7XHJcbiAgICAgIHBsYWNlc0xpc3QucHJlcGVuZChuZXdDYXJkKTtcclxuICAgICAgY2xvc2VNb2RhbChwb3B1cE5ld0NhcmQpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7IC8vINCy0YvQstC+0LTQuNC8INC+0YjQuNCx0LrRgyDQsiDQutC+0L3RgdC+0LvRjFxyXG4gICAgfSk7XHJcbiAgc2F2ZVBsYWNlQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC40YLRjCc7XHJcbn1cclxuXHJcbmZvcm1OZXdQbGFjZS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoKSA9PiB7XHJcbiAgc2F2ZVBsYWNlQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC10L3QuNC1Li4uJztcclxuICBpc0ltYWdlTGluayhcclxuICAgIGhhbmRsZUZvcm1OZXdQbGFjZVN1Ym1pdCxcclxuICAgIGZvcm1OZXdQbGFjZSxcclxuICAgIGxpbmtQbGFjZSxcclxuICAgIHNhdmVQbGFjZUJ1dHRvblxyXG4gICk7XHJcbn0pO1xyXG5cclxuLy8g0YPQtNCw0LvQtdC90LjQtSDQutCw0YDRgtC+0YfQutC4XHJcblxyXG5jb25zdCBmb3JtRGVsZXRlQ2FyZCA9IGRvY3VtZW50LmZvcm1zWydkZWxldGUtY2FyZCddO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgY2FyZERhdGEpIHtcclxuICBvcGVuTW9kYWwocG9wdXBEZWxldGUpO1xyXG4gIGNhcmRUb0RlbGV0ZS5jYXJkID0gY2FyZEVsZW1lbnQ7XHJcbiAgY2FyZFRvRGVsZXRlLmlkID0gY2FyZERhdGEuX2lkO1xyXG59XHJcblxyXG5mb3JtRGVsZXRlQ2FyZC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoKSA9PiB7XHJcbiAgcmVtb3ZlQ2FyZChjYXJkVG9EZWxldGUuaWQpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGRlbGV0ZUNhcmQoY2FyZFRvRGVsZXRlLmNhcmQpO1xyXG4gICAgICBjbG9zZU1vZGFsKHBvcHVwRGVsZXRlKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpOyAvLyDQstGL0LLQvtC00LjQvCDQvtGI0LjQsdC60YMg0LIg0LrQvtC90YHQvtC70YxcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbi8vIC0t0JLQsNC70LjQtNCw0YbQuNGPINGE0L7RgNC8LS1cclxuXHJcbmVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkNvbmZpZyk7XHJcblxyXG4vLyAtLUFQSS0tXHJcblxyXG5Qcm9taXNlLmFsbChbZ2V0VXNlckluZm8oKSwgZ2V0SW5pdGlhbENhcmRzKCldKVxyXG4gIC50aGVuKChyZXN1bHQpID0+IHtcclxuICAgIGNvbnN0IHVzZXIgPSByZXN1bHRbMF07XHJcbiAgICBjb25zdCBjYXJkcyA9IHJlc3VsdFsxXTtcclxuICAgIC8vINC+0LHRgNCw0LHQsNGC0YvQstCw0LXQvCDRgNC10LfRg9C70YzRgtCw0YJcclxuICAgIChwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXIubmFtZSksXHJcbiAgICAgIChwcm9maWxlSm9iLnRleHRDb250ZW50ID0gdXNlci5hYm91dCksXHJcbiAgICAgIChhdmF0YXJJbWcuc3R5bGUgPSBgYmFja2dyb3VuZC1pbWFnZTogdXJsKCR7dXNlci5hdmF0YXJ9KWApLFxyXG4gICAgICAobXlVc2VySWQgPSB1c2VyLl9pZCk7XHJcbiAgICBzaG93Q2FyZHMoY2FyZHMpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKGVycik7IC8vINCy0YvQstC+0LTQuNC8INC+0YjQuNCx0LrRgyDQsiDQutC+0L3RgdC+0LvRjFxyXG4gIH0pO1xyXG5cclxuZnVuY3Rpb24gc2hvd0NhcmRzKGNhcmRzKSB7XHJcbiAgY2FyZHMuZm9yRWFjaCgoY2FyZERhdGEpID0+IHtcclxuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JhZXRlQ2FyZChcclxuICAgICAgY2FyZERhdGEsXHJcbiAgICAgIG15VXNlcklkLFxyXG4gICAgICBoYW5kbGVMaWtlQ2FyZCxcclxuICAgICAgaGFuZGxlRGVsZXRlQ2FyZCxcclxuICAgICAgb3BlbkltZ1BvcHVwXHJcbiAgICApO1xyXG4gICAgcGxhY2VzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJjYXJkVGVtcGxhdGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiY3JhZXRlQ2FyZCIsImNhcmREYXRhIiwidXNlcklkIiwiaGFuZGxlTGlrZUNhcmQiLCJoYW5kbGVEZWxldGVDYXJkIiwib3BlbkltZ1BvcHVwIiwiY2FyZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJkZWxldGVCdXR0b24iLCJsaWtlQnV0dG9uIiwibGlrZUNvdW50ZXIiLCJjYXJkSW1hZ2UiLCJjYXJkVGl0bGUiLCJzcmMiLCJsaW5rIiwiYWx0IiwibmFtZSIsInRleHRDb250ZW50IiwibGlrZXMiLCJsZW5ndGgiLCJvd25lciIsIl9pZCIsInJlbW92ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJzb21lIiwibGlrZXIiLCJjbGFzc0xpc3QiLCJhZGQiLCJldnQiLCJjb250YWlucyIsInRvZ2dsZUlzTGlrZWQiLCJ0YXJnZXQiLCJjaGFuZ2VMaWtlIiwidXBkYXRlZENhcmQiLCJ0b2dnbGUiLCJvcGVuTW9kYWwiLCJwb3B1cCIsImNsaWNrSGFuZGxlciIsIndpbmRvdyIsImtleUhhbmRsZXIiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsInZhbGlkYXRpb25Db25maWciLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsInNob3dJbnB1dEVycm9yIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJlcnJvckVsZW1lbnQiLCJjb25jYXQiLCJpZCIsImhpZGVJbnB1dEVycm9yIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVkIiwiY2xlYXJWYWxpZGF0aW9uIiwiZm9ybSIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiaXNJbWFnZUxpbmsiLCJoYW5kbGVGdW5jdGlvbiIsImZldGNoIiwidmFsdWUiLCJ0aGVuIiwicmVzIiwib2siLCJoZWFkZXJzIiwiZ2V0IiwiaW5jbHVkZXMiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJteVVzZXJJZCIsImNvbmZpZyIsImJhc2VVcmwiLCJhdXRob3JpemF0aW9uIiwiY2hlY2tSZXNwb25zZSIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiYWRkTGlrZVJlcXVlc3QiLCJjYXJkSWQiLCJtZXRob2QiLCJyZW1vdmVMaWtlUmVxdWVzdCIsInBsYWNlc0xpc3QiLCJjYXJkVG9EZWxldGUiLCJlZGl0QnV0dG9uIiwiYWRkQnV0dG9uIiwiY2xvc2VCdXR0b25zIiwicG9wdXBzIiwicG9wdXBBdmF0YXIiLCJwb3B1cFByb2ZpbGVFZGl0IiwicG9wdXBOZXdDYXJkIiwicG9wdXBJbWFnZSIsInBvcHVwRGVsZXRlIiwic2NhbGVkSW1nIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlSm9iIiwiYXZhdGFySW1nIiwiY2FyZCIsImZvcm1OZXdBdmF0YXIiLCJyZXNldCIsImpvYiIsImZvcm1OZXdQbGFjZSIsImJ1dHRvbiIsImNsb3Nlc3QiLCJmb3JtcyIsImxpbmtBdmF0YXIiLCJzYXZlQXZhdGFyQnV0dG9uIiwiaGFuZGxlRm9ybU5ld0F2YXRhclN1Ym1pdCIsInVzZXJBdmF0YXIiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImF2YXRhciIsInVzZXIiLCJzdHlsZSIsImZvcm1FZGl0IiwiZGVzY3JpcHRpb24iLCJzYXZlVXNlckluZm9CdXR0b24iLCJ1c2VyTmFtZSIsInVzZXJBYm91dCIsImFib3V0IiwibmFtZVBsYWNlIiwibGlua1BsYWNlIiwic2F2ZVBsYWNlQnV0dG9uIiwiaGFuZGxlRm9ybU5ld1BsYWNlU3VibWl0IiwiY2FyZE5hbWUiLCJjYXJkTGluayIsIm5ld0NhcmQiLCJwcmVwZW5kIiwicHJldmVudERlZmF1bHQiLCJwYXR0ZXJuTWlzbWF0Y2giLCJzZXRDdXN0b21WYWxpZGl0eSIsImRhdGFzZXQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImlzVmFsaWQiLCJzZXRFdmVudExpc3RlbmVycyIsImFsbCIsInJlc3VsdCIsImNhcmRzIiwiYXBwZW5kIiwic2hvd0NhcmRzIl0sInNvdXJjZVJvb3QiOiIifQ==