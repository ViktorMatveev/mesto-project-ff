(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,o,r,c){var a=e.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__delete-button"),u=a.querySelector(".card__like-button"),s=a.querySelector(".card__like-counter"),l=a.querySelector(".card__image"),d=a.querySelector(".card__title");return l.src=t.link,l.alt=t.name,d.textContent=t.name,s.textContent=t.likes.length,n!==t.owner._id&&i.remove(),i.addEventListener("click",(function(){r(a,t)})),t.likes.some((function(e){return e._id===n}))?u.classList.add("card__like-button_is-active"):u.classList.remove("card__like-button_is-active"),u.addEventListener("click",(function(e){o(function(e){return!!e.classList.contains("card__like-button_is-active")}(e.target),t,a)})),a.addEventListener("click",c),a}function n(e,t){t.querySelector(".card__like-counter").textContent=e.likes.length,t.querySelector(".card__like-button").classList.toggle("card__like-button_is-active")}function o(e){e.classList.add("popup_is-opened"),e.addEventListener("click",r),window.addEventListener("keydown",a)}function r(e){e.target===document.querySelector(".popup_is-opened")&&c(document.querySelector(".popup_is-opened"))}function c(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",r),window.removeEventListener("keydown",a)}function a(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}var i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function u(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(i.inputErrorClass),o.textContent=n,o.classList.add(i.errorClass)}function s(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(i.inputErrorClass),n.classList.remove(i.errorClass),n.textContent=""}function l(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(i.inactiveButtonClass)):(t.disabled=!0,t.classList.add(i.inactiveButtonClass))}function d(e){var t=Array.from(e.querySelectorAll(i.inputSelector));t.forEach((function(t){s(e,t)})),l(t,e.querySelector(i.submitButtonSelector))}function p(e,t,n,o){fetch(n.value).then((function(r){r.ok&&r.headers.get("Content-Type").includes("image")?e():(u(t,n,"URL не передает изображение"),o.disabled=!0,o.classList.add(i.inactiveButtonClass),o.textContent="Сохранить")})).catch((function(e){console.log("Oшибка запроса",e)}))}var f,_={baseUrl:"https://nomoreparties.co/v1/wff-cohort-9",headers:{authorization:"6822d671-11c6-4eec-8c5d-59a6a77e5591","Content-Type":"application/json"}},m=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},v=function(e){return fetch("".concat(_.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:_.headers}).then((function(e){return m(e)}))},y=function(e){return fetch("".concat(_.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:_.headers}).then((function(e){return m(e)}))},h=document.querySelector(".places__list"),S={},b=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),C=Array.from(document.querySelectorAll(".popup__close")),L=Array.from(document.querySelectorAll(".popup")),g=document.querySelector(".popup_type_avatar"),E=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card"),x=document.querySelector(".popup_type_image"),A=document.querySelector(".popup_type_delete-card"),U=x.querySelector(".popup__caption"),w=x.querySelector(".popup__image"),T=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),P=document.querySelector(".profile__image");function O(e,t,o){e?y(t._id).then((function(e){return n(e,o)})).catch((function(e){console.log(e)})):v(t._id).then((function(e){return n(e,o)})).catch((function(e){console.log(e)}))}function N(e){e.target.classList.contains("card__image")&&(o(x),w.src=e.target.src,w.alt=e.target.alt,U.textContent=e.target.alt)}L.forEach((function(e){return e.classList.add("popup_is-animated")})),P.addEventListener("click",(function(){j.reset(),d(g.querySelector(".popup__form")),o(g)})),b.addEventListener("click",(function(){V.value=T.textContent,z.value=B.textContent,d(E.querySelector(".popup__form")),o(E)})),q.addEventListener("click",(function(){F.reset(),d(k.querySelector(".popup__form")),o(k)})),C.forEach((function(e){return e.addEventListener("click",(function(){c(e.closest(".popup"))}))}));var j=document.forms["edit-avatar"],D=j.avatar,J=j.querySelector(".popup__button");function M(e){var t;(t=D.value,fetch("".concat(_.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:_.headers,body:JSON.stringify({avatar:t})}).then((function(e){return m(e)}))).then((function(e){P.style="background-image: url(".concat(e.avatar,")"),c(g)})).catch((function(e){console.log(e)})).finally((function(){J.textContent="Сохранить"}))}j.addEventListener("submit",(function(){J.textContent="Сохранение...",p(M,j,D,J)}));var H=document.forms["edit-profile"],V=H.name,z=H.description,R=H.querySelector(".popup__button");H.addEventListener("submit",(function(){var e,t;R.textContent="Сохранение...",(e=V.value,t=z.value,fetch("".concat(_.baseUrl,"/users/me"),{method:"PATCH",headers:_.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return m(e)}))).then((function(e){T.textContent=e.name,B.textContent=e.about,c(E)})).catch((function(e){console.log(e)})).finally((function(){R.textContent="Сохранить"}))}));var F=document.forms["new-place"],G=F["place-name"],I=F.link,K=F.querySelector(".popup__button");function Q(e){var n,o;(n=G.value,o=I.value,fetch("".concat(_.baseUrl,"/cards"),{method:"POST",headers:_.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return m(e)}))).then((function(e){var n=t(e,f,O,W,N);h.prepend(n),c(k)})).catch((function(e){console.log(e)})).finally((function(){K.textContent="Сохранить"}))}function W(e,t){o(A),S.card=e,S.id=t._id}F.addEventListener("submit",(function(){K.textContent="Сохранение...",p(Q,F,I,K)})),document.forms["delete-card"].addEventListener("submit",(function(){var e;(e=S.id,fetch("".concat(_.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:_.headers}).then((function(e){return m(e)}))).then((function(e){S.card.remove(),c(A)})).catch((function(e){console.log(e)}))})),Array.from(document.querySelectorAll(i.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(i.inputSelector)),n=e.querySelector(i.submitButtonSelector);l(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?s(e,t):u(e,t,t.validationMessage)}(e,o),l(t,n)}))}))}(e)})),Promise.all([fetch("".concat(_.baseUrl,"/users/me"),{headers:_.headers}).then((function(e){return m(e)})),fetch("".concat(_.baseUrl,"/cards"),{headers:_.headers}).then((function(e){return m(e)}))]).then((function(e){var n=e[0],o=e[1];T.textContent=n.name,B.textContent=n.about,P.style="background-image: url(".concat(n.avatar,")"),f=n._id,function(e){e.forEach((function(e){var n=t(e,f,O,W,N);h.append(n)}))}(o)})).catch((function(e){console.log(e)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQUEsSUFBTUEsRUFBZUMsU0FBU0MsY0FBYyxrQkFBa0JDLFFBRTlELFNBQVNDLEVBQ1BDLEVBQ0FDLEVBQ0FDLEVBQ0FDLEVBQ0FDLEdBRUEsSUFBTUMsRUFBY1YsRUFBYUUsY0FBYyxTQUFTUyxXQUFVLEdBQzVEQyxFQUFlRixFQUFZUixjQUFjLHdCQUN6Q1csRUFBYUgsRUFBWVIsY0FBYyxzQkFDdkNZLEVBQWNKLEVBQVlSLGNBQWMsdUJBQ3hDYSxFQUFZTCxFQUFZUixjQUFjLGdCQUN0Q2MsRUFBWU4sRUFBWVIsY0FBYyxnQkFxQzVDLE9BbkNBYSxFQUFVRSxJQUFNWixFQUFTYSxLQUN6QkgsRUFBVUksSUFBTWQsRUFBU2UsS0FDekJKLEVBQVVLLFlBQWNoQixFQUFTZSxLQUNqQ04sRUFBWU8sWUFBY2hCLEVBQVNpQixNQUFNQyxPQUlyQ2pCLElBQVdELEVBQVNtQixNQUFNQyxLQUM1QmIsRUFBYWMsU0FLZmQsRUFBYWUsaUJBQWlCLFNBQVMsV0FDckNuQixFQUFpQkUsRUFBYUwsRUFDaEMsSUFJSUEsRUFBU2lCLE1BQU1NLE1BQUssU0FBQ0MsR0FBSyxPQUFLQSxFQUFNSixNQUFRbkIsQ0FBTSxJQUNyRE8sRUFBV2lCLFVBQVVDLElBQUksK0JBRXpCbEIsRUFBV2lCLFVBQVVKLE9BQU8sK0JBSzlCYixFQUFXYyxpQkFBaUIsU0FBUyxTQUFDSyxHQUNwQ3pCLEVBVUosU0FBdUJNLEdBQ3JCLFFBQU9BLEVBQVdpQixVQUFVRyxTQUFTLDhCQUd2QyxDQWRtQkMsQ0FBY0YsRUFBSUcsUUFBUzlCLEVBQVVLLEVBQ3RELElBSUFBLEVBQVlpQixpQkFBaUIsUUFBU2xCLEdBRS9CQyxDQUNULENBUUEsU0FBUzBCLEVBQVdDLEVBQWEzQixHQUMvQkEsRUFBWVIsY0FBYyx1QkFBdUJtQixZQUMvQ2dCLEVBQVlmLE1BQU1DLE9BQ3BCYixFQUNHUixjQUFjLHNCQUNkNEIsVUFBVVEsT0FBTyw4QkFDdEIsQ0NsRUEsU0FBU0MsRUFBVUMsR0FDakJBLEVBQU1WLFVBQVVDLElBQUksbUJBQ3BCUyxFQUFNYixpQkFBaUIsUUFBU2MsR0FDaENDLE9BQU9mLGlCQUFpQixVQUFXZ0IsRUFDckMsQ0FFQSxTQUFTRixFQUFhVCxHQUNoQkEsRUFBSUcsU0FBV2xDLFNBQVNDLGNBQWMscUJBQ3hDMEMsRUFBVzNDLFNBQVNDLGNBQWMsb0JBRXRDLENBRUEsU0FBUzBDLEVBQVdKLEdBQ2xCQSxFQUFNVixVQUFVSixPQUFPLG1CQUN2QmMsRUFBTUssb0JBQW9CLFFBQVNKLEdBQ25DQyxPQUFPRyxvQkFBb0IsVUFBV0YsRUFDeEMsQ0FFQSxTQUFTQSxFQUFXWCxHQUNGLFdBQVpBLEVBQUljLEtBQ05GLEVBQVczQyxTQUFTQyxjQUFjLG9CQUV0QyxDQ3RCQSxJQUFNNkMsRUFBbUIsQ0FDdkJDLGFBQWMsZUFDZEMsY0FBZSxnQkFDZkMscUJBQXNCLGlCQUN0QkMsb0JBQXFCLHlCQUNyQkMsZ0JBQWlCLDBCQUNqQkMsV0FBWSx3QkFHZCxTQUFTQyxFQUFlQyxFQUFhQyxFQUFjQyxHQUNqRCxJQUFNQyxFQUFlSCxFQUFZckQsY0FBYyxJQUFEeUQsT0FBS0gsRUFBYUksR0FBRSxXQUNsRUosRUFBYTFCLFVBQVVDLElBQUlnQixFQUFpQkssaUJBQzVDTSxFQUFhckMsWUFBY29DLEVBQzNCQyxFQUFhNUIsVUFBVUMsSUFBSWdCLEVBQWlCTSxXQUM5QyxDQUVBLFNBQVNRLEVBQWVOLEVBQWFDLEdBQ25DLElBQU1FLEVBQWVILEVBQVlyRCxjQUFjLElBQUR5RCxPQUFLSCxFQUFhSSxHQUFFLFdBQ2xFSixFQUFhMUIsVUFBVUosT0FBT3FCLEVBQWlCSyxpQkFDL0NNLEVBQWE1QixVQUFVSixPQUFPcUIsRUFBaUJNLFlBQy9DSyxFQUFhckMsWUFBYyxFQUM3QixDQWtEQSxTQUFTeUMsRUFBa0JDLEVBQVdDLElBTnRDLFNBQXlCRCxHQUN2QixPQUFPQSxFQUFVbkMsTUFBSyxTQUFDNEIsR0FDckIsT0FBUUEsRUFBYVMsU0FBU0MsS0FDaEMsR0FDRixDQUdNQyxDQUFnQkosSUFJbEJDLEVBQWNJLFVBQVcsRUFDekJKLEVBQWNsQyxVQUFVSixPQUFPcUIsRUFBaUJJLHVCQUpoRGEsRUFBY0ksVUFBVyxFQUN6QkosRUFBY2xDLFVBQVVDLElBQUlnQixFQUFpQkkscUJBS2pELENBRUEsU0FBU2tCLEVBQWdCQyxHQUN2QixJQUFNUCxFQUFZUSxNQUFNQyxLQUN0QkYsRUFBS0csaUJBQWlCMUIsRUFBaUJFLGdCQUV6Q2MsRUFBVVcsU0FBUSxTQUFDbEIsR0FDakJLLEVBQWVTLEVBQU1kLEVBQ3ZCLElBRUFNLEVBQWtCQyxFQURDTyxFQUFLcEUsY0FBYzZDLEVBQWlCRyxzQkFFekQsQ0FFQSxTQUFTeUIsRUFBWUMsRUFBZ0JyQixFQUFhQyxFQUFjUSxHQUM5RGEsTUFBTXJCLEVBQWFzQixPQUNoQkMsTUFBSyxTQUFDQyxHQUNEQSxFQUFJQyxJQUFNRCxFQUFJRSxRQUFRQyxJQUFJLGdCQUFnQkMsU0FBUyxTQUNyRFIsS0FHQXRCLEVBQWVDLEVBQWFDLEVBRFAsK0JBRXJCUSxFQUFjSSxVQUFXLEVBQ3pCSixFQUFjbEMsVUFBVUMsSUFBSWdCLEVBQWlCSSxxQkFDN0NhLEVBQWMzQyxZQUFjLFlBRWhDLElBQ0NnRSxPQUFNLFNBQUNDLEdBQ05DLFFBQVFDLElBQUksaUJBQWtCRixFQUNoQyxHQUNKLENDdkdBLElDbUJJRyxFRG5CRUMsRUFBUyxDQUNiQyxRQUFTLDJDQUNUVCxRQUFTLENBQ1BVLGNBQWUsdUNBQ2YsZUFBZ0IscUJBSWRDLEVBQWdCLFNBQUNiLEdBQ3JCLE9BQUlBLEVBQUlDLEdBQ0NELEVBQUljLE9BR0pDLFFBQVFDLE9BQU8sV0FBRHJDLE9BQVlxQixFQUFJaUIsUUFFekMsRUFrRE1DLEVBQWlCLFNBQUNDLEdBQ3RCLE9BQU90QixNQUFNLEdBQURsQixPQUFJK0IsRUFBT0MsUUFBTyxpQkFBQWhDLE9BQWdCd0MsR0FBVSxDQUN0REMsT0FBUSxNQUNSbEIsUUFBU1EsRUFBT1IsVUFDZkgsTUFBSyxTQUFDQyxHQUFHLE9BQUthLEVBQWNiLEVBQUksR0FDckMsRUFJTXFCLEVBQW9CLFNBQUNGLEdBQ3pCLE9BQU90QixNQUFNLEdBQURsQixPQUFJK0IsRUFBT0MsUUFBTyxpQkFBQWhDLE9BQWdCd0MsR0FBVSxDQUN0REMsT0FBUSxTQUNSbEIsUUFBU1EsRUFBT1IsVUFDZkgsTUFBSyxTQUFDQyxHQUFHLE9BQUthLEVBQWNiLEVBQUksR0FDckMsRUMzRE1zQixFQUFhckcsU0FBU0MsY0FBYyxpQkFDcENxRyxFQUFlLENBQUMsRUFJaEJDLEVBQWF2RyxTQUFTQyxjQUFjLHlCQUNwQ3VHLEVBQVl4RyxTQUFTQyxjQUFjLHdCQUNuQ3dHLEVBQWVuQyxNQUFNQyxLQUFLdkUsU0FBU3dFLGlCQUFpQixrQkFJcERrQyxFQUFTcEMsTUFBTUMsS0FBS3ZFLFNBQVN3RSxpQkFBaUIsV0FDOUNtQyxFQUFjM0csU0FBU0MsY0FBYyxzQkFDckMyRyxFQUFtQjVHLFNBQVNDLGNBQWMsb0JBQzFDNEcsRUFBZTdHLFNBQVNDLGNBQWMsd0JBQ3RDNkcsRUFBYTlHLFNBQVNDLGNBQWMscUJBQ3BDOEcsRUFBYy9HLFNBQVNDLGNBQWMsMkJBQ3JDYyxFQUFZK0YsRUFBVzdHLGNBQWMsbUJBQ3JDK0csRUFBWUYsRUFBVzdHLGNBQWMsaUJBRXJDZ0gsRUFBY2pILFNBQVNDLGNBQWMsbUJBQ3JDaUgsRUFBYWxILFNBQVNDLGNBQWMseUJBQ3BDa0gsRUFBWW5ILFNBQVNDLGNBQWMsbUJBTXpDLFNBQVNLLEVBQWUwRixFQUFRNUYsRUFBVWdILEdBQ25DcEIsRUFPSEksRUFBa0JoRyxFQUFTb0IsS0FDeEJzRCxNQUFLLFNBQUNDLEdBQUcsT0FBSzVDLEVBQVc0QyxFQUFLcUMsRUFBSyxJQUNuQ2hDLE9BQU0sU0FBQ0MsR0FDTkMsUUFBUUMsSUFBSUYsRUFDZCxJQVZGWSxFQUFlN0YsRUFBU29CLEtBQ3JCc0QsTUFBSyxTQUFDQyxHQUFHLE9BQUs1QyxFQUFXNEMsRUFBS3FDLEVBQUssSUFDbkNoQyxPQUFNLFNBQUNDLEdBQ05DLFFBQVFDLElBQUlGLEVBQ2QsR0FRTixDQW1DQSxTQUFTN0UsRUFBYXVCLEdBQ2hCQSxFQUFJRyxPQUFPTCxVQUFVRyxTQUFTLGlCQUNoQ00sRUFBVXdFLEdBQ1ZFLEVBQVVoRyxJQUFNZSxFQUFJRyxPQUFPbEIsSUFDM0JnRyxFQUFVOUYsSUFBTWEsRUFBSUcsT0FBT2hCLElBQzNCSCxFQUFVSyxZQUFjVyxFQUFJRyxPQUFPaEIsSUFFdkMsQ0E1REF3RixFQUFPakMsU0FBUSxTQUFDbEMsR0FBSyxPQUFLQSxFQUFNVixVQUFVQyxJQUFJLG9CQUFvQixJQXNCbEVxRixFQUFVekYsaUJBQWlCLFNBQVMsV0FDbEMyRixFQUFjQyxRQUNabEQsRUFBZ0J1QyxFQUFZMUcsY0FBYyxpQkFDMUNxQyxFQUFVcUUsRUFDZCxJQUlBSixFQUFXN0UsaUJBQWlCLFNBQVMsV0FDbkNQLEVBQUswRCxNQUFRb0MsRUFBWTdGLFlBQ3pCbUcsRUFBSTFDLE1BQVFxQyxFQUFXOUYsWUFDdkJnRCxFQUFnQndDLEVBQWlCM0csY0FBYyxpQkFDN0NxQyxFQUFVc0UsRUFDZCxJQUlBSixFQUFVOUUsaUJBQWlCLFNBQVMsV0FDbEM4RixFQUFhRixRQUNYbEQsRUFBZ0J5QyxFQUFhNUcsY0FBYyxpQkFDM0NxQyxFQUFVdUUsRUFDZCxJQUVBSixFQUFhaEMsU0FBUSxTQUFDZ0QsR0FBTSxPQUMxQkEsRUFBTy9GLGlCQUFpQixTQUFTLFdBQy9CaUIsRUFBVzhFLEVBQU9DLFFBQVEsVUFDNUIsR0FBRSxJQWtCSixJQUFNTCxFQUFnQnJILFNBQVMySCxNQUFNLGVBQy9CQyxFQUFhUCxFQUFzQixPQUNuQ1EsRUFBbUJSLEVBQWNwSCxjQUFjLGtCQUVyRCxTQUFTNkgsRUFBMEIvRixHRHJFVixJQUFDZ0csS0NzRVBILEVBQVcvQyxNRHJFckJELE1BQU0sR0FBRGxCLE9BQUkrQixFQUFPQyxRQUFPLG9CQUFvQixDQUNoRFMsT0FBUSxRQUNSbEIsUUFBU1EsRUFBT1IsUUFDaEIrQyxLQUFNQyxLQUFLQyxVQUFVLENBQUVDLE9BQVFKLE1BQzlCakQsTUFBSyxTQUFDQyxHQUFHLE9BQUthLEVBQWNiLEVBQUksS0NrRWhDRCxNQUFLLFNBQUNzRCxHQUNMakIsRUFBVWtCLE1BQVEseUJBQUgzRSxPQUE0QjBFLEVBQUtELE9BQU0sS0FDdER4RixFQUFXZ0UsRUFDYixJQUNDdkIsT0FBTSxTQUFDQyxHQUNOQyxRQUFRQyxJQUFJRixFQUNkLElBQ0NpRCxTQUFRLFdBQ1BULEVBQWlCekcsWUFBYyxXQUNqQyxHQUNKLENBQ0FpRyxFQUFjM0YsaUJBQWlCLFVBQVUsV0FDdkNtRyxFQUFpQnpHLFlBQWMsZ0JBQy9Cc0QsRUFDRW9ELEVBQ0FULEVBQ0FPLEVBQ0FDLEVBRUosSUFJQSxJQUFNVSxFQUFXdkksU0FBUzJILE1BQU0sZ0JBQzFCeEcsRUFBT29ILEVBQVNwSCxLQUNoQm9HLEVBQU1nQixFQUFTQyxZQUNmQyxFQUFxQkYsRUFBU3RJLGNBQWMsa0JBZ0JsRHNJLEVBQVM3RyxpQkFBaUIsVUFBVSxXQWRwQyxJRDdHd0JnSCxFQUFVQyxFQzRIaENGLEVBQW1CckgsWUFBYyxpQkQ1SFhzSCxFQzhHUHZILEVBQUswRCxNRDlHWThELEVDOEdMcEIsRUFBSTFDLE1EN0d4QkQsTUFBTSxHQUFEbEIsT0FBSStCLEVBQU9DLFFBQU8sYUFBYSxDQUN6Q1MsT0FBUSxRQUNSbEIsUUFBU1EsRUFBT1IsUUFDaEIrQyxLQUFNQyxLQUFLQyxVQUFVLENBQUUvRyxLQUFNdUgsRUFBVUUsTUFBT0QsTUFDN0M3RCxNQUFLLFNBQUNDLEdBQUcsT0FBS2EsRUFBY2IsRUFBSSxLQzBHaENELE1BQUssU0FBQ3NELEdBQ0xuQixFQUFZN0YsWUFBY2dILEVBQUtqSCxLQUMvQitGLEVBQVc5RixZQUFjZ0gsRUFBS1EsTUFDOUJqRyxFQUFXaUUsRUFDYixJQUNDeEIsT0FBTSxTQUFDQyxHQUNOQyxRQUFRQyxJQUFJRixFQUNkLElBQ0NpRCxTQUFRLFdBQ1BHLEVBQW1CckgsWUFBYyxXQUNuQyxHQUtKLElBSUEsSUFBTW9HLEVBQWV4SCxTQUFTMkgsTUFBTSxhQUM5QmtCLEVBQVlyQixFQUFhLGNBQ3pCc0IsRUFBWXRCLEVBQW1CLEtBQy9CdUIsRUFBa0J2QixFQUFhdkgsY0FBYyxrQkFFbkQsU0FBUytJLEVBQXlCakgsR0RuSFIsSUFBQ2tILEVBQVVDLEdBQVZELEVDb0hQSixFQUFVaEUsTURwSE9xRSxFQ29IQUosRUFBVWpFLE1Ebkh0Q0QsTUFBTSxHQUFEbEIsT0FBSStCLEVBQU9DLFFBQU8sVUFBVSxDQUN0Q1MsT0FBUSxPQUNSbEIsUUFBU1EsRUFBT1IsUUFDaEIrQyxLQUFNQyxLQUFLQyxVQUFVLENBQUUvRyxLQUFNOEgsRUFBVWhJLEtBQU1pSSxNQUM1Q3BFLE1BQUssU0FBQ0MsR0FBRyxPQUFLYSxFQUFjYixFQUFJLEtDZ0hoQ0QsTUFBSyxTQUFDMUUsR0FDTCxJQUFNK0ksRUFBVWhKLEVBQ2RDLEVBQ0FvRixFQUNBbEYsRUFDQUMsRUFDQUMsR0FFRjZGLEVBQVcrQyxRQUFRRCxHQUNuQnhHLEVBQVdrRSxFQUNiLElBQ0N6QixPQUFNLFNBQUNDLEdBQ05DLFFBQVFDLElBQUlGLEVBQ2QsSUFDQ2lELFNBQVEsV0FDUFMsRUFBZ0IzSCxZQUFjLFdBQ2hDLEdBQ0osQ0FnQkEsU0FBU2IsRUFBaUJFLEVBQWFMLEdBQ3JDa0MsRUFBVXlFLEdBQ1ZULEVBQWFjLEtBQU8zRyxFQUNwQjZGLEVBQWEzQyxHQUFLdkQsRUFBU29CLEdBQzdCLENBbEJBZ0csRUFBYTlGLGlCQUFpQixVQUFVLFdBQ3RDcUgsRUFBZ0IzSCxZQUFjLGdCQUM5QnNELEVBQ0VzRSxFQUNBeEIsRUFDQXNCLEVBQ0FDLEVBRUosSUFJdUIvSSxTQUFTMkgsTUFBTSxlQVF2QmpHLGlCQUFpQixVQUFVLFdEaEl2QixJQUFDd0UsS0NpSVBJLEVBQWEzQyxHRGhJakJpQixNQUFNLEdBQURsQixPQUFJK0IsRUFBT0MsUUFBTyxXQUFBaEMsT0FBVXdDLEdBQVUsQ0FDaERDLE9BQVEsU0FDUmxCLFFBQVNRLEVBQU9SLFVBQ2ZILE1BQUssU0FBQ0MsR0FBRyxPQUFLYSxFQUFjYixFQUFJLEtDOEhoQ0QsTUFBSyxTQUFDQyxHQUNNdUIsRUFBYWMsS0p0SnZCM0YsU0l1SkRrQixFQUFXb0UsRUFDYixJQUNDM0IsT0FBTSxTQUFDQyxHQUNOQyxRQUFRQyxJQUFJRixFQUNkLEdBQ0osSUYzS21CZixNQUFNQyxLQUNyQnZFLFNBQVN3RSxpQkFBaUIxQixFQUFpQkMsZUFFcEMwQixTQUFRLFNBQUNuQixHQUNoQkEsRUFBWTVCLGlCQUFpQixVQUFVLFNBQUNLLEdBQ3RDQSxFQUFJc0gsZ0JBQ04sSUF2QkosU0FBMkIvRixHQUN6QixJQUFNUSxFQUFZUSxNQUFNQyxLQUN0QmpCLEVBQVlrQixpQkFBaUIxQixFQUFpQkUsZ0JBRTFDZSxFQUFnQlQsRUFBWXJELGNBQ2hDNkMsRUFBaUJHLHNCQUVuQlksRUFBa0JDLEVBQVdDLEdBQzdCRCxFQUFVVyxTQUFRLFNBQUNsQixHQUNqQkEsRUFBYTdCLGlCQUFpQixTQUFTLFlBdkIzQyxTQUFpQjRCLEVBQWFDLEdBQ3hCQSxFQUFhUyxTQUFTc0YsZ0JBQ3hCL0YsRUFBYWdHLGtCQUFrQmhHLEVBQWFpRyxRQUFRaEcsY0FFcERELEVBQWFnRyxrQkFBa0IsSUFHNUJoRyxFQUFhUyxTQUFTQyxNQUd6QkwsRUFBZU4sRUFBYUMsR0FGNUJGLEVBQWVDLEVBQWFDLEVBQWNBLEVBQWFrRyxrQkFJM0QsQ0FZTUMsQ0FBUXBHLEVBQWFDLEdBQ3JCTSxFQUFrQkMsRUFBV0MsRUFDL0IsR0FDRixHQUNGLENBVUk0RixDQUFrQnJHLEVBQ3BCLElFMktGd0MsUUFBUThELElBQUksQ0R4TUhoRixNQUFNLEdBQURsQixPQUFJK0IsRUFBT0MsUUFBTyxhQUFhLENBQ3pDVCxRQUFTUSxFQUFPUixVQUNmSCxNQUFLLFNBQUNDLEdBQUcsT0FBS2EsRUFBY2IsRUFBSSxJQVY1QkgsTUFBTSxHQUFEbEIsT0FBSStCLEVBQU9DLFFBQU8sVUFBVSxDQUN0Q1QsUUFBU1EsRUFBT1IsVUFDZkgsTUFBSyxTQUFDQyxHQUFHLE9BQUthLEVBQWNiLEVBQUksTUMrTWxDRCxNQUFLLFNBQUMrRSxHQUNMLElBQU16QixFQUFPeUIsRUFBTyxHQUNkQyxFQUFRRCxFQUFPLEdBRXBCNUMsRUFBWTdGLFlBQWNnSCxFQUFLakgsS0FDN0IrRixFQUFXOUYsWUFBY2dILEVBQUtRLE1BQzlCekIsRUFBVWtCLE1BQVEseUJBQUgzRSxPQUE0QjBFLEVBQUtELE9BQU0sS0FDdEQzQyxFQUFXNEMsRUFBSzVHLElBT3ZCLFNBQW1Cc0ksR0FDakJBLEVBQU1yRixTQUFRLFNBQUNyRSxHQUNiLElBQU1LLEVBQWNOLEVBQ2xCQyxFQUNBb0YsRUFDQWxGLEVBQ0FDLEVBQ0FDLEdBRUY2RixFQUFXMEQsT0FBT3RKLEVBQ3BCLEdBQ0YsQ0FqQkl1SixDQUFVRixFQUNaLElBQ0MxRSxPQUFNLFNBQUNDLEdBQ05DLFFBQVFDLElBQUlGLEVBQ2QsRyIsInNvdXJjZXMiOlsid2VicGFjazovL21lc3RvLXByb2plY3QvLi9zcmMvc2NyaXB0cy9jb25tcG9uZW50cy9jYXJkLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QvLi9zcmMvc2NyaXB0cy9jb25tcG9uZW50cy9tb2RhbC5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0Ly4vc3JjL3NjcmlwdHMvY29ubXBvbmVudHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0Ly4vc3JjL3NjcmlwdHMvY29ubXBvbmVudHMvYXBpLmpzIiwid2VicGFjazovL21lc3RvLXByb2plY3QvLi9zcmMvc2NyaXB0cy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2FyZC10ZW1wbGF0ZScpLmNvbnRlbnQ7XHJcblxyXG5mdW5jdGlvbiBjcmFldGVDYXJkKFxyXG4gIGNhcmREYXRhLFxyXG4gIHVzZXJJZCxcclxuICBoYW5kbGVMaWtlQ2FyZCxcclxuICBoYW5kbGVEZWxldGVDYXJkLFxyXG4gIG9wZW5JbWdQb3B1cFxyXG4pIHtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKCcuY2FyZCcpLmNsb25lTm9kZSh0cnVlKTtcclxuICBjb25zdCBkZWxldGVCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpO1xyXG4gIGNvbnN0IGxpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKTtcclxuICBjb25zdCBsaWtlQ291bnRlciA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWNvdW50ZXInKTtcclxuICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9faW1hZ2UnKTtcclxuICBjb25zdCBjYXJkVGl0bGUgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fdGl0bGUnKTtcclxuXHJcbiAgY2FyZEltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XHJcbiAgY2FyZEltYWdlLmFsdCA9IGNhcmREYXRhLm5hbWU7XHJcbiAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcclxuICBsaWtlQ291bnRlci50ZXh0Q29udGVudCA9IGNhcmREYXRhLmxpa2VzLmxlbmd0aDtcclxuXHJcbiAgLy8g0YPQtNCw0LvRj9C10Lwg0LrQvtGA0LfQuNC90LrRgyDRgSDRh9GD0LbQvtC5INC60LDRgNGC0L7Rh9C60LhcclxuXHJcbiAgaWYgKHVzZXJJZCAhPT0gY2FyZERhdGEub3duZXIuX2lkKSB7XHJcbiAgICBkZWxldGVCdXR0b24ucmVtb3ZlKCk7XHJcbiAgfVxyXG5cclxuICAvLyDRgdC70YPRiNCw0YLQtdC70Ywg0L3QsCDQutC90L7Qv9C60YMg0YPQtNCw0LvQtdC90LjRj1xyXG5cclxuICBkZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBjYXJkRGF0YSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vINC+0LHRgNCw0LHQvtGC0YfQuNC6INC70LDQudC60LAg0L/RgNC4INC30LDQs9GA0YPQutC1INGB0YLRgNCw0L3QuNGG0YtcclxuXHJcbiAgaWYgKGNhcmREYXRhLmxpa2VzLnNvbWUoKGxpa2VyKSA9PiBsaWtlci5faWQgPT09IHVzZXJJZCkpIHtcclxuICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LmFkZCgnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGxpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJyk7XHJcbiAgfVxyXG5cclxuICAvLyDRgdC70YPRiNCw0YLQtdC70Ywg0L3QsCDQutC90L7Qv9C60YMg0LvQsNC50LrQsFxyXG5cclxuICBsaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2dCkgPT4ge1xyXG4gICAgaGFuZGxlTGlrZUNhcmQodG9nZ2xlSXNMaWtlZChldnQudGFyZ2V0KSwgY2FyZERhdGEsIGNhcmRFbGVtZW50KTtcclxuICB9KTtcclxuXHJcbiAgLy8g0YHQu9GD0YjQsNGC0LXQu9GMINC90LAg0LrQsNGA0YLQuNC90LrRg1xyXG5cclxuICBjYXJkRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5JbWdQb3B1cCk7XHJcblxyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlSXNMaWtlZChsaWtlQnV0dG9uKSB7XHJcbiAgcmV0dXJuIGxpa2VCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKVxyXG4gICAgPyB0cnVlXHJcbiAgICA6IGZhbHNlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjaGFuZ2VMaWtlKHVwZGF0ZWRDYXJkLCBjYXJkRWxlbWVudCkge1xyXG4gIGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWNvdW50ZXInKS50ZXh0Q29udGVudCA9XHJcbiAgICB1cGRhdGVkQ2FyZC5saWtlcy5sZW5ndGg7XHJcbiAgY2FyZEVsZW1lbnRcclxuICAgIC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKVxyXG4gICAgLmNsYXNzTGlzdC50b2dnbGUoJ2NhcmRfX2xpa2UtYnV0dG9uX2lzLWFjdGl2ZScpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBkZWxldGVDYXJkKGNhcmQpIHtcclxuICBjYXJkLnJlbW92ZSgpO1xyXG59XHJcblxyXG5leHBvcnQgeyBjYXJkVGVtcGxhdGUsIGNyYWV0ZUNhcmQsIHRvZ2dsZUlzTGlrZWQsIGRlbGV0ZUNhcmQsIGNoYW5nZUxpa2UgfTtcclxuIiwiZnVuY3Rpb24gb3Blbk1vZGFsKHBvcHVwKSB7XHJcbiAgcG9wdXAuY2xhc3NMaXN0LmFkZCgncG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGlja0hhbmRsZXIpO1xyXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywga2V5SGFuZGxlcik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsaWNrSGFuZGxlcihldnQpIHtcclxuICBpZiAoZXZ0LnRhcmdldCA9PT0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX2lzLW9wZW5lZCcpKSB7XHJcbiAgICBjbG9zZU1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9pcy1vcGVuZWQnKSk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZU1vZGFsKHBvcHVwKSB7XHJcbiAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgcG9wdXAucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGlja0hhbmRsZXIpO1xyXG4gIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywga2V5SGFuZGxlcik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGtleUhhbmRsZXIoZXZ0KSB7XHJcbiAgaWYgKGV2dC5rZXkgPT09ICdFc2NhcGUnKSB7XHJcbiAgICBjbG9zZU1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9pcy1vcGVuZWQnKSk7XHJcbiAgfVxyXG59XHJcbmV4cG9ydCB7IG9wZW5Nb2RhbCwgY2xvc2VNb2RhbCB9O1xyXG4iLCJjb25zdCB2YWxpZGF0aW9uQ29uZmlnID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogJy5wb3B1cF9fZm9ybScsXHJcbiAgaW5wdXRTZWxlY3RvcjogJy5wb3B1cF9faW5wdXQnLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiAnLnBvcHVwX19idXR0b24nLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6ICdwb3B1cF9fYnV0dG9uX2Rpc2FibGVkJyxcclxuICBpbnB1dEVycm9yQ2xhc3M6ICdwb3B1cF9faW5wdXRfdHlwZV9lcnJvcicsXHJcbiAgZXJyb3JDbGFzczogJ3BvcHVwX19lcnJvcl92aXNpYmxlJyxcclxufTtcclxuXHJcbmZ1bmN0aW9uIHNob3dJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh2YWxpZGF0aW9uQ29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHZhbGlkYXRpb25Db25maWcuZXJyb3JDbGFzcyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQpIHtcclxuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XHJcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodmFsaWRhdGlvbkNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHZhbGlkYXRpb25Db25maWcuZXJyb3JDbGFzcyk7XHJcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gJyc7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzVmFsaWQoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCkge1xyXG4gIGlmIChpbnB1dEVsZW1lbnQudmFsaWRpdHkucGF0dGVybk1pc21hdGNoKSB7XHJcbiAgICBpbnB1dEVsZW1lbnQuc2V0Q3VzdG9tVmFsaWRpdHkoaW5wdXRFbGVtZW50LmRhdGFzZXQuZXJyb3JNZXNzYWdlKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaW5wdXRFbGVtZW50LnNldEN1c3RvbVZhbGlkaXR5KCcnKTtcclxuICB9XHJcblxyXG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50KTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50KSB7XHJcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkNvbmZpZy5pbnB1dFNlbGVjdG9yKVxyXG4gICk7XHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICB2YWxpZGF0aW9uQ29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgKTtcclxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQpO1xyXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgaXNWYWxpZChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50KTtcclxuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKCkgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkNvbmZpZy5mb3JtU2VsZWN0b3IpXHJcbiAgKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xyXG4gICAgZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGV2dCkgPT4ge1xyXG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQpO1xyXG4gIH0pO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50KSB7XHJcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XHJcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCh2YWxpZGF0aW9uQ29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodmFsaWRhdGlvbkNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFyVmFsaWRhdGlvbihmb3JtKSB7XHJcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcclxuICAgIGZvcm0ucXVlcnlTZWxlY3RvckFsbCh2YWxpZGF0aW9uQ29uZmlnLmlucHV0U2VsZWN0b3IpXHJcbiAgKTtcclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtLCBpbnB1dEVsZW1lbnQpO1xyXG4gIH0pO1xyXG4gIGNvbnN0IGZvcm1CdXR0b24gPSBmb3JtLnF1ZXJ5U2VsZWN0b3IodmFsaWRhdGlvbkNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBmb3JtQnV0dG9uKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNJbWFnZUxpbmsoaGFuZGxlRnVuY3Rpb24sIGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGJ1dHRvbkVsZW1lbnQpIHtcclxuICBmZXRjaChpbnB1dEVsZW1lbnQudmFsdWUpXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2sgJiYgcmVzLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnKS5pbmNsdWRlcygnaW1hZ2UnKSkge1xyXG4gICAgICAgIGhhbmRsZUZ1bmN0aW9uKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gJ1VSTCDQvdC1INC/0LXRgNC10LTQsNC10YIg0LjQt9C+0LHRgNCw0LbQtdC90LjQtSc7XHJcbiAgICAgICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgICBidXR0b25FbGVtZW50LnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC40YLRjCc7XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZygnT9GI0LjQsdC60LAg0LfQsNC/0YDQvtGB0LAnLCBlcnIpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIGNsZWFyVmFsaWRhdGlvbiwgdmFsaWRhdGlvbkNvbmZpZywgaXNJbWFnZUxpbmsgfTtcclxuIiwiLy8gLS3RgNCw0LHQvtGC0LAg0YEgQVBJLS1cclxuXHJcbi8vINCi0L7QutC10L06IDY4MjJkNjcxLTExYzYtNGVlYy04YzVkLTU5YTZhNzdlNTU5MVxyXG4vLyDQmNC00LXQvdGC0LjRhNC40LrQsNGC0L7RgCDQs9GA0YPQv9C/0Ys6IHdmZi1jb2hvcnQtOVxyXG5cclxuY29uc3QgY29uZmlnID0ge1xyXG4gIGJhc2VVcmw6ICdodHRwczovL25vbW9yZXBhcnRpZXMuY28vdjEvd2ZmLWNvaG9ydC05JyxcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiAnNjgyMmQ2NzEtMTFjNi00ZWVjLThjNWQtNTlhNmE3N2U1NTkxJyxcclxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgfSxcclxufTtcclxuXHJcbmNvbnN0IGNoZWNrUmVzcG9uc2UgPSAocmVzKSA9PiB7XHJcbiAgaWYgKHJlcy5vaykge1xyXG4gICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vINC10YHQu9C4INC+0YjQuNCx0LrQsCwg0L7RgtC60LvQvtC90Y/QtdC8INC/0YDQvtC80LjRgVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGDQntGI0LjQsdC60LA6ICR7cmVzLnN0YXR1c31gKTtcclxuICB9XHJcbn07XHJcblxyXG4vLyDQt9Cw0L/RgNC+0YEg0L3QsCDQv9C+0LvRg9GH0LXQvdC40LUg0LrQsNGA0YLQvtGH0LXQulxyXG5cclxuY29uc3QgZ2V0SW5pdGlhbENhcmRzID0gKCkgPT4ge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICB9KS50aGVuKChyZXMpID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn07XHJcblxyXG4vLyDQt9Cw0L/RgNC+0YEg0L3QsCDQuNC90YTQviDQviDQv9C+0LvRjNC30L7QstCw0YLQtdC70LVcclxuXHJcbmNvbnN0IGdldFVzZXJJbmZvID0gKCkgPT4ge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICB9KS50aGVuKChyZXMpID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn07XHJcblxyXG4vLyDQt9Cw0L/RgNC+0YEg0L3QsCDQuNC30LzQtdC90LXQvdC40LUg0LjQvdGE0L7RgNC80LDRhtC40Lgg0L4g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C1XHJcblxyXG5jb25zdCB1cGRhdGVVc2VySW5mbyA9ICh1c2VyTmFtZSwgdXNlckFib3V0KSA9PiB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgIG1ldGhvZDogJ1BBVENIJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lOiB1c2VyTmFtZSwgYWJvdXQ6IHVzZXJBYm91dCB9KSxcclxuICB9KS50aGVuKChyZXMpID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn07XHJcblxyXG4vLyDQt9Cw0L/RgNC+0YEg0L3QsCDQuNC30LzQtdC90LXQvdC40LUg0LDQstCw0YLQsNGA0LAg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPXHJcblxyXG5jb25zdCB1cGRhdGVVc2VyQXZhdGFyID0gKHVzZXJBdmF0YXIpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgIG1ldGhvZDogJ1BBVENIJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhdmF0YXI6IHVzZXJBdmF0YXIgfSksXHJcbiAgfSkudGhlbigocmVzKSA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59O1xyXG5cclxuLy8g0LfQsNC/0YDQvtGBINC90LAg0LTQvtCx0LDQstC70LXQvdC40LUg0LrQsNGA0YLQvtGH0LrQuCDQvdCwINGB0LXRgNCy0LXRgFxyXG5cclxuY29uc3QgYWRkTmV3Q2FyZFJlcXVlc3QgPSAoY2FyZE5hbWUsIGNhcmRMaW5rKSA9PiB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWU6IGNhcmROYW1lLCBsaW5rOiBjYXJkTGluayB9KSxcclxuICB9KS50aGVuKChyZXMpID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn07XHJcblxyXG4vLyDQt9Cw0L/RgNC+0YEg0L3QsCDQtNC+0LHQsNC70LXQvdC40LUg0LvQsNC50LrQsFxyXG5cclxuY29uc3QgYWRkTGlrZVJlcXVlc3QgPSAoY2FyZElkKSA9PiB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiBjaGVja1Jlc3BvbnNlKHJlcykpO1xyXG59O1xyXG5cclxuLy8g0LfQsNC/0YDQvtGBINC90LAg0YHQvdGP0YLQuNC1INC70LDQudC60LBcclxuXHJcbmNvbnN0IHJlbW92ZUxpa2VSZXF1ZXN0ID0gKGNhcmRJZCkgPT4ge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCwge1xyXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gIH0pLnRoZW4oKHJlcykgPT4gY2hlY2tSZXNwb25zZShyZXMpKTtcclxufTtcclxuXHJcbi8vINC30LDQv9GA0L7RgSDQvdCwINGD0LTQsNC70LXQvdC40LUg0LrQsNGA0YLQvtGH0LrQuFxyXG5cclxuY29uc3QgcmVtb3ZlQ2FyZCA9IChjYXJkSWQpID0+IHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICB9KS50aGVuKChyZXMpID0+IGNoZWNrUmVzcG9uc2UocmVzKSk7XHJcbn07XHJcblxyXG5leHBvcnQge1xyXG4gIGdldEluaXRpYWxDYXJkcyxcclxuICBnZXRVc2VySW5mbyxcclxuICB1cGRhdGVVc2VySW5mbyxcclxuICB1cGRhdGVVc2VyQXZhdGFyLFxyXG4gIGFkZE5ld0NhcmRSZXF1ZXN0LFxyXG4gIGFkZExpa2VSZXF1ZXN0LFxyXG4gIHJlbW92ZUxpa2VSZXF1ZXN0LFxyXG4gIHJlbW92ZUNhcmQsXHJcbn07XHJcbiIsImltcG9ydCAnLi4vcGFnZXMvaW5kZXguY3NzJztcclxuXHJcbmltcG9ydCB7IGNyYWV0ZUNhcmQsIGRlbGV0ZUNhcmQsIGNoYW5nZUxpa2UgfSBmcm9tICcuL2Nvbm1wb25lbnRzL2NhcmQnO1xyXG5cclxuaW1wb3J0IHsgb3Blbk1vZGFsLCBjbG9zZU1vZGFsIH0gZnJvbSAnLi9jb25tcG9uZW50cy9tb2RhbCc7XHJcblxyXG5pbXBvcnQge1xyXG4gIGVuYWJsZVZhbGlkYXRpb24sXHJcbiAgY2xlYXJWYWxpZGF0aW9uLFxyXG4gIHZhbGlkYXRpb25Db25maWcsXHJcbiAgaXNJbWFnZUxpbmssXHJcbn0gZnJvbSAnLi9jb25tcG9uZW50cy92YWxpZGF0aW9uJztcclxuXHJcbmltcG9ydCB7XHJcbiAgZ2V0SW5pdGlhbENhcmRzLFxyXG4gIGdldFVzZXJJbmZvLFxyXG4gIHVwZGF0ZVVzZXJJbmZvLFxyXG4gIHVwZGF0ZVVzZXJBdmF0YXIsXHJcbiAgYWRkTmV3Q2FyZFJlcXVlc3QsXHJcbiAgYWRkTGlrZVJlcXVlc3QsXHJcbiAgcmVtb3ZlTGlrZVJlcXVlc3QsXHJcbiAgcmVtb3ZlQ2FyZCxcclxufSBmcm9tICcuL2Nvbm1wb25lbnRzL2FwaSc7XHJcblxyXG5sZXQgbXlVc2VySWQ7XHJcbmNvbnN0IHBsYWNlc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxhY2VzX19saXN0Jyk7XHJcbmNvbnN0IGNhcmRUb0RlbGV0ZSA9IHt9O1xyXG5cclxuLy8gLWJ1dHRvbnMtXHJcblxyXG5jb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2VkaXQtYnV0dG9uJyk7XHJcbmNvbnN0IGFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7XHJcbmNvbnN0IGNsb3NlQnV0dG9ucyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwX19jbG9zZScpKTtcclxuXHJcbi8vIC1wb3B1cHMtXHJcblxyXG5jb25zdCBwb3B1cHMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wb3B1cCcpKTtcclxuY29uc3QgcG9wdXBBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9hdmF0YXInKTtcclxuY29uc3QgcG9wdXBQcm9maWxlRWRpdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2VkaXQnKTtcclxuY29uc3QgcG9wdXBOZXdDYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfbmV3LWNhcmQnKTtcclxuY29uc3QgcG9wdXBJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2ltYWdlJyk7XHJcbmNvbnN0IHBvcHVwRGVsZXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfZGVsZXRlLWNhcmQnKTtcclxuY29uc3QgY2FyZFRpdGxlID0gcG9wdXBJbWFnZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2NhcHRpb24nKTtcclxuY29uc3Qgc2NhbGVkSW1nID0gcG9wdXBJbWFnZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2ltYWdlJyk7XHJcblxyXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX190aXRsZScpO1xyXG5jb25zdCBwcm9maWxlSm9iID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2Rlc2NyaXB0aW9uJyk7XHJcbmNvbnN0IGF2YXRhckltZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19pbWFnZScpO1xyXG5cclxucG9wdXBzLmZvckVhY2goKHBvcHVwKSA9PiBwb3B1cC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9pcy1hbmltYXRlZCcpKTtcclxuXHJcbi8vINGB0LvRg9GI0LDRgtC10LvRjCDQvtCx0YDQsNCx0L7RgtGH0LjQutCwINC70LDQudC60LBcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUxpa2VDYXJkKHN0YXR1cywgY2FyZERhdGEsIGNhcmQpIHtcclxuICBpZiAoIXN0YXR1cykge1xyXG4gICAgYWRkTGlrZVJlcXVlc3QoY2FyZERhdGEuX2lkKVxyXG4gICAgICAudGhlbigocmVzKSA9PiBjaGFuZ2VMaWtlKHJlcywgY2FyZCkpXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTsgLy8g0LLRi9Cy0L7QtNC40Lwg0L7RiNC40LHQutGDINCyINC60L7QvdGB0L7Qu9GMXHJcbiAgICAgIH0pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZW1vdmVMaWtlUmVxdWVzdChjYXJkRGF0YS5faWQpXHJcbiAgICAgIC50aGVuKChyZXMpID0+IGNoYW5nZUxpa2UocmVzLCBjYXJkKSlcclxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpOyAvLyDQstGL0LLQvtC00LjQvCDQvtGI0LjQsdC60YMg0LIg0LrQvtC90YHQvtC70YxcclxuICAgICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyAtLdCy0YvQt9C+0LIg0Lgg0LfQsNGA0YvRgtC40LUg0LzQvtC00LDQu9GM0L3Ri9GFINC+0LrQvtC9LS1cclxuLy8g0LDQstCw0YLQsNGAXHJcbmF2YXRhckltZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICBmb3JtTmV3QXZhdGFyLnJlc2V0KCksXHJcbiAgICBjbGVhclZhbGlkYXRpb24ocG9wdXBBdmF0YXIucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtJykpLFxyXG4gICAgb3Blbk1vZGFsKHBvcHVwQXZhdGFyKTtcclxufSk7XHJcblxyXG4vLyDRgNC10LTQsNC60YLQuNGA0L7QstCw0L3QuNC1INC/0YDQvtGE0LjQu9GPXHJcblxyXG5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIG5hbWUudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcclxuICBqb2IudmFsdWUgPSBwcm9maWxlSm9iLnRleHRDb250ZW50O1xyXG4gIGNsZWFyVmFsaWRhdGlvbihwb3B1cFByb2ZpbGVFZGl0LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybScpKSxcclxuICAgIG9wZW5Nb2RhbChwb3B1cFByb2ZpbGVFZGl0KTtcclxufSk7XHJcblxyXG4vLyDQvdC+0LLQvtC1INC80LXRgdGC0L5cclxuXHJcbmFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICBmb3JtTmV3UGxhY2UucmVzZXQoKSxcclxuICAgIGNsZWFyVmFsaWRhdGlvbihwb3B1cE5ld0NhcmQucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtJykpLFxyXG4gICAgb3Blbk1vZGFsKHBvcHVwTmV3Q2FyZCk7XHJcbn0pO1xyXG5cclxuY2xvc2VCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT5cclxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBjbG9zZU1vZGFsKGJ1dHRvbi5jbG9zZXN0KCcucG9wdXAnKSk7XHJcbiAgfSlcclxuKTtcclxuXHJcbi8vINC/0L7Qv9Cw0L8g0YEg0LrQsNGA0YLQuNC90LrQvtC5XHJcblxyXG5mdW5jdGlvbiBvcGVuSW1nUG9wdXAoZXZ0KSB7XHJcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJkX19pbWFnZScpKSB7XHJcbiAgICBvcGVuTW9kYWwocG9wdXBJbWFnZSk7XHJcbiAgICBzY2FsZWRJbWcuc3JjID0gZXZ0LnRhcmdldC5zcmM7XHJcbiAgICBzY2FsZWRJbWcuYWx0ID0gZXZ0LnRhcmdldC5hbHQ7XHJcbiAgICBjYXJkVGl0bGUudGV4dENvbnRlbnQgPSBldnQudGFyZ2V0LmFsdDtcclxuICB9XHJcbn1cclxuXHJcbi8vIC0t0KDQsNCx0L7RgtCwINGBINGE0L7RgNC80LDQvNC4LS1cclxuXHJcbi8vINGB0LzQtdC90LjRgtGMINCw0LLQsNGC0LDRgFxyXG5cclxuY29uc3QgZm9ybU5ld0F2YXRhciA9IGRvY3VtZW50LmZvcm1zWydlZGl0LWF2YXRhciddO1xyXG5jb25zdCBsaW5rQXZhdGFyID0gZm9ybU5ld0F2YXRhclsnYXZhdGFyJ107XHJcbmNvbnN0IHNhdmVBdmF0YXJCdXR0b24gPSBmb3JtTmV3QXZhdGFyLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fYnV0dG9uJyk7XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVGb3JtTmV3QXZhdGFyU3VibWl0KGV2dCkge1xyXG4gIHVwZGF0ZVVzZXJBdmF0YXIobGlua0F2YXRhci52YWx1ZSlcclxuICAgIC50aGVuKCh1c2VyKSA9PiB7XHJcbiAgICAgIGF2YXRhckltZy5zdHlsZSA9IGBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHt1c2VyLmF2YXRhcn0pYDtcclxuICAgICAgY2xvc2VNb2RhbChwb3B1cEF2YXRhcik7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTsgLy8g0LLRi9Cy0L7QtNC40Lwg0L7RiNC40LHQutGDINCyINC60L7QvdGB0L7Qu9GMXHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBzYXZlQXZhdGFyQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC40YLRjCc7XHJcbiAgICB9KTtcclxufVxyXG5mb3JtTmV3QXZhdGFyLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsICgpID0+IHtcclxuICBzYXZlQXZhdGFyQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC10L3QuNC1Li4uJztcclxuICBpc0ltYWdlTGluayhcclxuICAgIGhhbmRsZUZvcm1OZXdBdmF0YXJTdWJtaXQsXHJcbiAgICBmb3JtTmV3QXZhdGFyLFxyXG4gICAgbGlua0F2YXRhcixcclxuICAgIHNhdmVBdmF0YXJCdXR0b25cclxuICApO1xyXG59KTtcclxuXHJcbi8vINGA0LXQtNCw0LrRgtC40YDQstC+0LDRgtGMINC/0YDQvtGE0LjQu9GMXHJcblxyXG5jb25zdCBmb3JtRWRpdCA9IGRvY3VtZW50LmZvcm1zWydlZGl0LXByb2ZpbGUnXTtcclxuY29uc3QgbmFtZSA9IGZvcm1FZGl0Lm5hbWU7XHJcbmNvbnN0IGpvYiA9IGZvcm1FZGl0LmRlc2NyaXB0aW9uO1xyXG5jb25zdCBzYXZlVXNlckluZm9CdXR0b24gPSBmb3JtRWRpdC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlRm9ybUVkaXRTdWJtaXQoZXZ0KSB7XHJcbiAgdXBkYXRlVXNlckluZm8obmFtZS52YWx1ZSwgam9iLnZhbHVlKVxyXG4gICAgLnRoZW4oKHVzZXIpID0+IHtcclxuICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyLm5hbWU7XHJcbiAgICAgIHByb2ZpbGVKb2IudGV4dENvbnRlbnQgPSB1c2VyLmFib3V0O1xyXG4gICAgICBjbG9zZU1vZGFsKHBvcHVwUHJvZmlsZUVkaXQpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7IC8vINCy0YvQstC+0LTQuNC8INC+0YjQuNCx0LrRgyDQsiDQutC+0L3RgdC+0LvRjFxyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgc2F2ZVVzZXJJbmZvQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC40YLRjCc7XHJcbiAgICB9KTtcclxufVxyXG5mb3JtRWRpdC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoKSA9PiB7XHJcbiAgc2F2ZVVzZXJJbmZvQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC10L3QuNC1Li4uJztcclxuICBoYW5kbGVGb3JtRWRpdFN1Ym1pdCgpO1xyXG59KTtcclxuXHJcbi8vINC90L7QstC+0LUg0LzQtdGB0YLQvlxyXG5cclxuY29uc3QgZm9ybU5ld1BsYWNlID0gZG9jdW1lbnQuZm9ybXNbJ25ldy1wbGFjZSddO1xyXG5jb25zdCBuYW1lUGxhY2UgPSBmb3JtTmV3UGxhY2VbJ3BsYWNlLW5hbWUnXTtcclxuY29uc3QgbGlua1BsYWNlID0gZm9ybU5ld1BsYWNlWydsaW5rJ107XHJcbmNvbnN0IHNhdmVQbGFjZUJ1dHRvbiA9IGZvcm1OZXdQbGFjZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlRm9ybU5ld1BsYWNlU3VibWl0KGV2dCkge1xyXG4gIGFkZE5ld0NhcmRSZXF1ZXN0KG5hbWVQbGFjZS52YWx1ZSwgbGlua1BsYWNlLnZhbHVlKVxyXG4gICAgLnRoZW4oKGNhcmREYXRhKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld0NhcmQgPSBjcmFldGVDYXJkKFxyXG4gICAgICAgIGNhcmREYXRhLFxyXG4gICAgICAgIG15VXNlcklkLFxyXG4gICAgICAgIGhhbmRsZUxpa2VDYXJkLFxyXG4gICAgICAgIGhhbmRsZURlbGV0ZUNhcmQsXHJcbiAgICAgICAgb3BlbkltZ1BvcHVwXHJcbiAgICAgICk7XHJcbiAgICAgIHBsYWNlc0xpc3QucHJlcGVuZChuZXdDYXJkKTtcclxuICAgICAgY2xvc2VNb2RhbChwb3B1cE5ld0NhcmQpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7IC8vINCy0YvQstC+0LTQuNC8INC+0YjQuNCx0LrRgyDQsiDQutC+0L3RgdC+0LvRjFxyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgc2F2ZVBsYWNlQnV0dG9uLnRleHRDb250ZW50ID0gJ9Ch0L7RhdGA0LDQvdC40YLRjCc7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZm9ybU5ld1BsYWNlLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsICgpID0+IHtcclxuICBzYXZlUGxhY2VCdXR0b24udGV4dENvbnRlbnQgPSAn0KHQvtGF0YDQsNC90LXQvdC40LUuLi4nO1xyXG4gIGlzSW1hZ2VMaW5rKFxyXG4gICAgaGFuZGxlRm9ybU5ld1BsYWNlU3VibWl0LFxyXG4gICAgZm9ybU5ld1BsYWNlLFxyXG4gICAgbGlua1BsYWNlLFxyXG4gICAgc2F2ZVBsYWNlQnV0dG9uXHJcbiAgKTtcclxufSk7XHJcblxyXG4vLyDRg9C00LDQu9C10L3QuNC1INC60LDRgNGC0L7Rh9C60LhcclxuXHJcbmNvbnN0IGZvcm1EZWxldGVDYXJkID0gZG9jdW1lbnQuZm9ybXNbJ2RlbGV0ZS1jYXJkJ107XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBjYXJkRGF0YSkge1xyXG4gIG9wZW5Nb2RhbChwb3B1cERlbGV0ZSk7XHJcbiAgY2FyZFRvRGVsZXRlLmNhcmQgPSBjYXJkRWxlbWVudDtcclxuICBjYXJkVG9EZWxldGUuaWQgPSBjYXJkRGF0YS5faWQ7XHJcbn1cclxuXHJcbmZvcm1EZWxldGVDYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsICgpID0+IHtcclxuICByZW1vdmVDYXJkKGNhcmRUb0RlbGV0ZS5pZClcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgZGVsZXRlQ2FyZChjYXJkVG9EZWxldGUuY2FyZCk7XHJcbiAgICAgIGNsb3NlTW9kYWwocG9wdXBEZWxldGUpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7IC8vINCy0YvQstC+0LTQuNC8INC+0YjQuNCx0LrRgyDQsiDQutC+0L3RgdC+0LvRjFxyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuLy8gLS3QktCw0LvQuNC00LDRhtC40Y8g0YTQvtGA0LwtLVxyXG5cclxuZW5hYmxlVmFsaWRhdGlvbih2YWxpZGF0aW9uQ29uZmlnKTtcclxuXHJcbi8vIC0tQVBJLS1cclxuXHJcblByb21pc2UuYWxsKFtnZXRVc2VySW5mbygpLCBnZXRJbml0aWFsQ2FyZHMoKV0pXHJcbiAgLnRoZW4oKHJlc3VsdCkgPT4ge1xyXG4gICAgY29uc3QgdXNlciA9IHJlc3VsdFswXTtcclxuICAgIGNvbnN0IGNhcmRzID0gcmVzdWx0WzFdO1xyXG4gICAgLy8g0L7QsdGA0LDQsdCw0YLRi9Cy0LDQtdC8INGA0LXQt9GD0LvRjNGC0LDRglxyXG4gICAgKHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlci5uYW1lKSxcclxuICAgICAgKHByb2ZpbGVKb2IudGV4dENvbnRlbnQgPSB1c2VyLmFib3V0KSxcclxuICAgICAgKGF2YXRhckltZy5zdHlsZSA9IGBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJHt1c2VyLmF2YXRhcn0pYCksXHJcbiAgICAgIChteVVzZXJJZCA9IHVzZXIuX2lkKTtcclxuICAgIHNob3dDYXJkcyhjYXJkcyk7XHJcbiAgfSlcclxuICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coZXJyKTsgLy8g0LLRi9Cy0L7QtNC40Lwg0L7RiNC40LHQutGDINCyINC60L7QvdGB0L7Qu9GMXHJcbiAgfSk7XHJcblxyXG5mdW5jdGlvbiBzaG93Q2FyZHMoY2FyZHMpIHtcclxuICBjYXJkcy5mb3JFYWNoKChjYXJkRGF0YSkgPT4ge1xyXG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmFldGVDYXJkKFxyXG4gICAgICBjYXJkRGF0YSxcclxuICAgICAgbXlVc2VySWQsXHJcbiAgICAgIGhhbmRsZUxpa2VDYXJkLFxyXG4gICAgICBoYW5kbGVEZWxldGVDYXJkLFxyXG4gICAgICBvcGVuSW1nUG9wdXBcclxuICAgICk7XHJcbiAgICBwbGFjZXNMaXN0LmFwcGVuZChjYXJkRWxlbWVudCk7XHJcbiAgfSk7XHJcbn1cclxuIl0sIm5hbWVzIjpbImNhcmRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjcmFldGVDYXJkIiwiY2FyZERhdGEiLCJ1c2VySWQiLCJoYW5kbGVMaWtlQ2FyZCIsImhhbmRsZURlbGV0ZUNhcmQiLCJvcGVuSW1nUG9wdXAiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImRlbGV0ZUJ1dHRvbiIsImxpa2VCdXR0b24iLCJsaWtlQ291bnRlciIsImNhcmRJbWFnZSIsImNhcmRUaXRsZSIsInNyYyIsImxpbmsiLCJhbHQiLCJuYW1lIiwidGV4dENvbnRlbnQiLCJsaWtlcyIsImxlbmd0aCIsIm93bmVyIiwiX2lkIiwicmVtb3ZlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInNvbWUiLCJsaWtlciIsImNsYXNzTGlzdCIsImFkZCIsImV2dCIsImNvbnRhaW5zIiwidG9nZ2xlSXNMaWtlZCIsInRhcmdldCIsImNoYW5nZUxpa2UiLCJ1cGRhdGVkQ2FyZCIsInRvZ2dsZSIsIm9wZW5Nb2RhbCIsInBvcHVwIiwiY2xpY2tIYW5kbGVyIiwid2luZG93Iiwia2V5SGFuZGxlciIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5IiwidmFsaWRhdGlvbkNvbmZpZyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwic2hvd0lucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZSIsImVycm9yRWxlbWVudCIsImNvbmNhdCIsImlkIiwiaGlkZUlucHV0RXJyb3IiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZWQiLCJjbGVhclZhbGlkYXRpb24iLCJmb3JtIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJpc0ltYWdlTGluayIsImhhbmRsZUZ1bmN0aW9uIiwiZmV0Y2giLCJ2YWx1ZSIsInRoZW4iLCJyZXMiLCJvayIsImhlYWRlcnMiLCJnZXQiLCJpbmNsdWRlcyIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsIm15VXNlcklkIiwiY29uZmlnIiwiYmFzZVVybCIsImF1dGhvcml6YXRpb24iLCJjaGVja1Jlc3BvbnNlIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJhZGRMaWtlUmVxdWVzdCIsImNhcmRJZCIsIm1ldGhvZCIsInJlbW92ZUxpa2VSZXF1ZXN0IiwicGxhY2VzTGlzdCIsImNhcmRUb0RlbGV0ZSIsImVkaXRCdXR0b24iLCJhZGRCdXR0b24iLCJjbG9zZUJ1dHRvbnMiLCJwb3B1cHMiLCJwb3B1cEF2YXRhciIsInBvcHVwUHJvZmlsZUVkaXQiLCJwb3B1cE5ld0NhcmQiLCJwb3B1cEltYWdlIiwicG9wdXBEZWxldGUiLCJzY2FsZWRJbWciLCJwcm9maWxlTmFtZSIsInByb2ZpbGVKb2IiLCJhdmF0YXJJbWciLCJjYXJkIiwiZm9ybU5ld0F2YXRhciIsInJlc2V0Iiwiam9iIiwiZm9ybU5ld1BsYWNlIiwiYnV0dG9uIiwiY2xvc2VzdCIsImZvcm1zIiwibGlua0F2YXRhciIsInNhdmVBdmF0YXJCdXR0b24iLCJoYW5kbGVGb3JtTmV3QXZhdGFyU3VibWl0IiwidXNlckF2YXRhciIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYXZhdGFyIiwidXNlciIsInN0eWxlIiwiZmluYWxseSIsImZvcm1FZGl0IiwiZGVzY3JpcHRpb24iLCJzYXZlVXNlckluZm9CdXR0b24iLCJ1c2VyTmFtZSIsInVzZXJBYm91dCIsImFib3V0IiwibmFtZVBsYWNlIiwibGlua1BsYWNlIiwic2F2ZVBsYWNlQnV0dG9uIiwiaGFuZGxlRm9ybU5ld1BsYWNlU3VibWl0IiwiY2FyZE5hbWUiLCJjYXJkTGluayIsIm5ld0NhcmQiLCJwcmVwZW5kIiwicHJldmVudERlZmF1bHQiLCJwYXR0ZXJuTWlzbWF0Y2giLCJzZXRDdXN0b21WYWxpZGl0eSIsImRhdGFzZXQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImlzVmFsaWQiLCJzZXRFdmVudExpc3RlbmVycyIsImFsbCIsInJlc3VsdCIsImNhcmRzIiwiYXBwZW5kIiwic2hvd0NhcmRzIl0sInNvdXJjZVJvb3QiOiIifQ==